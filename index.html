<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Estad√≠stico de Calidad - Aplicativo Interactivo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script>
        // Sistema de protecci√≥n con expiraci√≥n
        (function(){
            const _0x1a = 'spc_trial_start';
            const _0x1b = 10; // d√≠as de prueba
            const _0x1c = localStorage.getItem(_0x1a);

            if (!_0x1c) {
                localStorage.setItem(_0x1a, new Date().getTime().toString());
            } else {
                const _0x1d = parseInt(_0x1c);
                const _0x1e = new Date().getTime();
                const _0x1f = Math.floor((_0x1e - _0x1d) / (1000 * 60 * 60 * 24));

                if (_0x1f >= _0x1b) {
                    document.addEventListener('DOMContentLoaded', function() {
                        document.body.innerHTML = `
                            <div style="display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);">
                                <div style="background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);padding:60px;border-radius:20px;text-align:center;max-width:500px;">
                                    <div style="font-size:80px;margin-bottom:20px;">‚è∞</div>
                                    <h1 style="color:#ff6b6b;font-family:Arial,sans-serif;margin-bottom:20px;">Per√≠odo de Prueba Finalizado</h1>
                                    <p style="color:#fff;font-family:Arial,sans-serif;font-size:18px;line-height:1.6;">
                                        Su licencia de prueba de ${_0x1b} d√≠as ha expirado.<br><br>
                                        Para continuar usando el aplicativo de Control Estad√≠stico de Calidad,
                                        contacte al proveedor para obtener una licencia completa.
                                    </p>
                                    <div style="margin-top:30px;padding:20px;background:rgba(255,107,107,0.2);border-radius:10px;">
                                        <p style="color:#ff6b6b;font-family:Arial,sans-serif;margin:0;">
                                            üìß Contacto: soporte@universidad.edu
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    return;
                }

                // Mostrar d√≠as restantes
                window._trialDaysLeft = _0x1b - _0x1f;
            }

            // Deshabilitar clic derecho
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });

            // Deshabilitar teclas de desarrollador
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' ||
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                    (e.ctrlKey && e.key === 'u') ||
                    (e.ctrlKey && e.key === 'U') ||
                    (e.ctrlKey && e.key === 's') ||
                    (e.ctrlKey && e.key === 'S')) {
                    e.preventDefault();
                    return false;
                }
            });
        })();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        :root {
            --primary: #0d47a1;
            --primary-dark: #002171;
            --primary-light: #5472d3;
            --secondary: #00897b;
            --secondary-light: #4ebaaa;
            --accent: #ff6f00;
            --accent-light: #ffa040;
            --success: #2e7d32;
            --warning: #f9a825;
            --danger: #c62828;
            --bg-dark: #0a1929;
            --bg-card: #132f4c;
            --text-primary: #ffffff;
            --text-secondary: #b2bac2;
            --gradient-primary: linear-gradient(135deg, #0d47a1 0%, #1976d2 100%);
            --gradient-secondary: linear-gradient(135deg, #00897b 0%, #26a69a 100%);
            --gradient-accent: linear-gradient(135deg, #ff6f00 0%, #ff9800 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1929 0%, #1a237e 50%, #0d47a1 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 50px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .login-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 16px;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            font-size: 18px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            text-align: center;
            letter-spacing: 3px;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary-light);
            background: rgba(255, 255, 255, 0.15);
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: normal;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            background: var(--gradient-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(13, 71, 161, 0.4);
        }

        .login-error {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        /* Header */
        .header {
            background: var(--gradient-primary);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 40px;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .logo-text span {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .trial-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Navigation */
        .nav-container {
            background: var(--bg-card);
            padding: 0 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            max-width: 1400px;
            margin: 0 auto;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 18px 28px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
            background: rgba(13, 71, 161, 0.1);
        }

        .nav-tab .icon {
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 40px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-icon {
            font-size: 32px;
        }

        .card-title {
            font-size: 22px;
            font-weight: 600;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Section Styles */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 25px 0 15px;
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, rgba(13, 71, 161, 0.2) 0%, rgba(25, 118, 210, 0.1) 100%);
            border: 1px solid rgba(13, 71, 161, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .formula {
            font-size: 24px;
            font-family: 'Times New Roman', serif;
            color: #64b5f6;
            margin: 10px 0;
        }

        .formula-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* Info Box */
        .info-box {
            background: rgba(0, 137, 123, 0.15);
            border-left: 4px solid var(--secondary);
            border-radius: 0 12px 12px 0;
            padding: 15px 20px;
            margin: 15px 0;
        }

        .info-box.warning {
            background: rgba(249, 168, 37, 0.15);
            border-left-color: var(--warning);
        }

        .info-box.danger {
            background: rgba(198, 40, 40, 0.15);
            border-left-color: var(--danger);
        }

        /* Charts Container */
        .chart-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .chart-wrapper {
            position: relative;
            height: 350px;
        }

        /* Interactive Controls */
        .controls-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
        }

        .control-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .control-input {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-accent {
            background: var(--gradient-accent);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table th {
            background: var(--primary);
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Exercise Styles */
        .exercise-card {
            background: linear-gradient(135deg, rgba(0, 137, 123, 0.1) 0%, rgba(38, 166, 154, 0.05) 100%);
            border: 1px solid rgba(0, 137, 123, 0.3);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
        }

        .exercise-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .exercise-number {
            background: var(--gradient-secondary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .exercise-title {
            font-size: 18px;
            font-weight: 600;
        }

        .exercise-content {
            margin: 15px 0;
        }

        .exercise-options {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }

        .exercise-option {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exercise-option:hover {
            border-color: var(--secondary);
            background: rgba(0, 137, 123, 0.1);
        }

        .exercise-option.selected {
            border-color: var(--primary-light);
            background: rgba(13, 71, 161, 0.2);
        }

        .exercise-option.correct {
            border-color: var(--success);
            background: rgba(46, 125, 50, 0.2);
        }

        .exercise-option.incorrect {
            border-color: var(--danger);
            background: rgba(198, 40, 40, 0.2);
        }

        .exercise-feedback {
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .exercise-feedback.correct {
            display: block;
            background: rgba(46, 125, 50, 0.2);
            border: 1px solid var(--success);
        }

        .exercise-feedback.incorrect {
            display: block;
            background: rgba(198, 40, 40, 0.2);
            border: 1px solid var(--danger);
        }

        /* Control Chart Types Grid */
        .chart-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .chart-type-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-type-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-light);
            box-shadow: 0 10px 30px rgba(13, 71, 161, 0.2);
        }

        .chart-type-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .chart-type-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .chart-type-full-name {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .chart-type-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .chart-type-use {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
        }

        .chart-type-use strong {
            color: var(--secondary-light);
        }

        /* Capability Indicators */
        .capability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .capability-indicator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .capability-indicator:hover {
            transform: scale(1.05);
        }

        .capability-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .capability-value.good {
            color: var(--success);
        }

        .capability-value.marginal {
            color: var(--warning);
        }

        .capability-value.poor {
            color: var(--danger);
        }

        .capability-label {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .capability-status {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .capability-status.good {
            background: rgba(46, 125, 50, 0.2);
            color: var(--success);
        }

        .capability-status.marginal {
            background: rgba(249, 168, 37, 0.2);
            color: var(--warning);
        }

        .capability-status.poor {
            background: rgba(198, 40, 40, 0.2);
            color: var(--danger);
        }

        /* Interactive Slider */
        .slider-container {
            margin: 20px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gradient-primary);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Gamification Stats */
        .stats-bar {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-icon {
            font-size: 24px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-light);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-tabs {
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .nav-tab {
                padding: 12px 16px;
                font-size: 13px;
            }

            .main-content {
                padding: 20px;
            }

            .card {
                padding: 20px;
            }

            .controls-panel {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-slide {
            animation: slideIn 0.5s ease forwards;
        }

        .animate-scale {
            animation: scaleIn 0.5s ease forwards;
        }

        /* ========================================
           ENHANCED UX ANIMATIONS
           ======================================== */

        /* Smooth page load animation */
        @keyframes pageLoad {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Staggered card entrance */
        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Subtle float animation for icons */
        @keyframes subtleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Glow pulse for important elements */
        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(66, 165, 245, 0.3); }
            50% { box-shadow: 0 0 20px rgba(66, 165, 245, 0.6); }
        }

        /* Number counter animation */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ripple effect for buttons */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Shake animation for errors */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Success bounce */
        @keyframes successBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Progress bar animation */
        @keyframes progressShine {
            from { left: -100%; }
            to { left: 100%; }
        }

        /* Tab content transition */
        .tab-content {
            display: none;
            animation: cardEntrance 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Card animations on page load */
        .card {
            animation: cardEntrance 0.5s ease-out backwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }

        /* Enhanced card hover effects */
        .card {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s ease,
                        border-color 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(66, 165, 245, 0.3);
        }

        /* Chart type cards with staggered animation */
        .chart-type-card {
            animation: cardEntrance 0.5s ease-out backwards;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-types-grid .chart-type-card:nth-child(1) { animation-delay: 0.15s; }
        .chart-types-grid .chart-type-card:nth-child(2) { animation-delay: 0.25s; }
        .chart-types-grid .chart-type-card:nth-child(3) { animation-delay: 0.35s; }
        .chart-types-grid .chart-type-card:nth-child(4) { animation-delay: 0.45s; }

        .chart-type-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(13, 71, 161, 0.25);
        }

        .chart-type-card:hover .chart-type-icon {
            animation: subtleFloat 2s ease-in-out infinite;
        }

        /* Button enhancements */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:active::after {
            animation: ripple 0.6s ease-out;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        /* Nav tab animations */
        .nav-tab {
            position: relative;
            transition: all 0.3s ease;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: var(--primary-light);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }

        .nav-tab:hover::after {
            width: 60%;
        }

        .nav-tab.active::after {
            width: 100%;
        }

        .nav-tab .icon {
            transition: transform 0.3s ease;
        }

        .nav-tab:hover .icon {
            transform: scale(1.15);
        }

        /* Form control animations */
        .control-input {
            transition: all 0.3s ease;
        }

        .control-input:focus {
            transform: scale(1.01);
            box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.2);
        }

        /* Exercise option animations */
        .exercise-option {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .exercise-option:hover {
            transform: translateX(8px);
            border-color: var(--secondary);
        }

        .exercise-option.correct {
            animation: successBounce 0.4s ease;
        }

        .exercise-option.incorrect {
            animation: shake 0.5s ease;
        }

        /* Stats bar value animation */
        .stat-value {
            transition: all 0.3s ease;
        }

        .stat-item:hover .stat-value {
            transform: scale(1.1);
            color: var(--accent);
        }

        .stat-item:hover .stat-icon {
            animation: subtleFloat 1s ease-in-out infinite;
        }

        /* Info box hover */
        .info-box {
            transition: all 0.3s ease;
        }

        .info-box:hover {
            transform: translateX(5px);
            border-left-width: 6px;
        }

        /* Formula box glow on hover */
        .formula-box {
            transition: all 0.3s ease;
        }

        .formula-box:hover {
            box-shadow: 0 0 20px rgba(13, 71, 161, 0.3);
            transform: scale(1.01);
        }

        /* Capability indicator animations */
        .capability-indicator {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .capability-indicator:hover {
            transform: translateY(-5px) scale(1.05);
        }

        .capability-indicator:hover .capability-value {
            animation: glowPulse 1.5s infinite;
        }

        /* Step animations */
        .step {
            transition: all 0.3s ease;
        }

        .step:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Table row hover animation */
        .data-table tr {
            transition: all 0.2s ease;
        }

        .data-table tr:hover {
            transform: scale(1.01);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* Slider thumb animation */
        .slider::-webkit-slider-thumb {
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(13, 71, 161, 0.5);
        }

        /* XP Bar shine effect */
        #xpBar {
            position: relative;
            overflow: hidden;
        }

        #xpBar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progressShine 2s infinite;
        }

        /* Login screen animations */
        .login-container {
            animation: cardEntrance 0.6s ease-out;
        }

        .login-input {
            transition: all 0.3s ease;
        }

        .login-input:focus {
            transform: scale(1.02);
        }

        .login-error {
            animation: shake 0.5s ease;
        }

        /* Chart container loading animation */
        .chart-container {
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* Achievement card hover enhancement */
        .achievement-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .achievement-card:hover {
            transform: translateY(-5px);
        }

        .achievement-card:hover .achievement-icon {
            animation: subtleFloat 1.5s ease-in-out infinite;
        }

        /* Intro hero animation */
        .intro-hero {
            animation: pageLoad 0.8s ease-out;
        }

        .intro-stat {
            animation: cardEntrance 0.6s ease-out backwards;
        }

        .intro-stats .intro-stat:nth-child(1) { animation-delay: 0.3s; }
        .intro-stats .intro-stat:nth-child(2) { animation-delay: 0.45s; }
        .intro-stats .intro-stat:nth-child(3) { animation-delay: 0.6s; }

        .intro-stat:hover .intro-stat-value {
            transform: scale(1.1);
            transition: transform 0.3s ease;
        }

        /* Header logo subtle animation */
        .logo-icon {
            transition: transform 0.3s ease;
        }

        .logo:hover .logo-icon {
            transform: rotate(10deg) scale(1.1);
        }

        /* Trial badge pulse */
        .trial-badge {
            animation: glowPulse 3s infinite;
        }

        /* Smooth scrollbar (webkit) */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        /* Tooltip animation (if used) */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            font-size: 12px;
            border-radius: 6px;
            white-space: nowrap;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        [data-tooltip]:hover::before {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        /* Quiz timer pulse when low */
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); color: var(--danger); }
            50% { transform: scale(1.1); }
        }

        .timer-warning {
            animation: timerPulse 0.5s infinite;
        }

        /* Results emoji bounce */
        #resultsEmoji {
            animation: successBounce 0.6s ease-out;
        }

        /* Notification slide in */
        @keyframes notificationSlide {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Achievement Cards */
        .achievement-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .achievement-card.unlocked {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(255, 111, 0, 0.2) 0%, rgba(255, 152, 0, 0.1) 100%);
            animation: achievementUnlock 0.5s ease;
        }

        @keyframes achievementUnlock {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .achievement-icon {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }

        .achievement-name {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .achievement-desc {
            font-size: 11px;
            color: var(--text-secondary);
            display: block;
        }

        /* Process Distribution Visual */
        .distribution-visual {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }

        .spec-limits {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 50px;
        }

        .spec-limit {
            font-size: 14px;
            color: var(--danger);
            font-weight: 600;
        }

        /* Limit lines in charts */
        .limit-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            font-size: 13px;
        }

        .limit-line {
            width: 30px;
            height: 3px;
            border-radius: 2px;
        }

        .limit-line.ucl {
            background: var(--danger);
        }

        .limit-line.cl {
            background: var(--success);
        }

        .limit-line.lcl {
            background: var(--danger);
        }

        /* Two column layout */
        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
        }

        /* Introduction hero */
        .intro-hero {
            background: linear-gradient(135deg, rgba(13, 71, 161, 0.3) 0%, rgba(0, 137, 123, 0.2) 100%);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            margin-bottom: 30px;
        }

        .intro-hero h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .intro-hero p {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        .intro-stats {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 30px;
        }

        .intro-stat {
            text-align: center;
        }

        .intro-stat-value {
            font-size: 40px;
            font-weight: 700;
            color: var(--primary-light);
        }

        .intro-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Constant Tables */
        .constants-table {
            font-size: 13px;
            overflow-x: auto;
        }

        .constants-table th {
            font-size: 12px;
            padding: 8px 10px;
        }

        .constants-table td {
            padding: 8px 10px;
        }

        /* Input with button */
        .input-with-btn {
            display: flex;
            gap: 10px;
        }

        .input-with-btn input {
            flex: 1;
        }

        /* Step indicators */
        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .step {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border-left: 3px solid var(--primary-light);
        }

        .step-number {
            background: var(--gradient-primary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin-bottom: 5px;
        }

        .step-content p {
            font-size: 14px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-icon">üìä</div>
            <h2 class="login-title">Control Estad√≠stico de Calidad</h2>
            <p class="login-subtitle">Aplicativo Interactivo para Ingenier√≠a Industrial</p>
            <input type="password" id="passwordInput" class="login-input" placeholder="Ingrese contrase√±a" autocomplete="off">
            <button onclick="verifyPassword()" class="login-btn">Ingresar</button>
            <p id="loginError" class="login-error">Contrase√±a incorrecta. Intente nuevamente.</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üìä</span>
                    <div class="logo-text">
                        <h1>Control Estad√≠stico de Calidad</h1>
                        <span>Herramienta de Aprendizaje Interactivo</span>
                    </div>
                </div>
                <div class="trial-badge" id="trialBadge">
                    <span>‚è±Ô∏è</span>
                    <span id="trialDays">Cargando...</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('intro')">
                    <span class="icon">üè†</span> Introducci√≥n
                </button>
                <button class="nav-tab" onclick="showTab('control-charts')">
                    <span class="icon">üìà</span> Gr√°ficos de Control
                </button>
                <button class="nav-tab" onclick="showTab('capability')">
                    <span class="icon">üéØ</span> Capacidad de Proceso
                </button>
                <button class="nav-tab" onclick="showTab('tools')">
                    <span class="icon">üîß</span> Herramientas
                </button>
                <button class="nav-tab" onclick="showTab('exercises')">
                    <span class="icon">‚úèÔ∏è</span> Ejercicios
                </button>
                <button class="nav-tab" onclick="showTab('simulator')">
                    <span class="icon">üß™</span> Simulador
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tab: Introduction -->
            <div id="intro" class="tab-content active">
                <div class="intro-hero">
                    <h2>üéØ Bienvenido al Control Estad√≠stico de Calidad</h2>
                    <p>Aprende a dominar las herramientas estad√≠sticas m√°s importantes para garantizar la calidad en procesos industriales. Desde gr√°ficos de control hasta an√°lisis de capacidad de proceso.</p>
                    <div class="intro-stats">
                        <div class="intro-stat">
                            <div class="intro-stat-value">7</div>
                            <div class="intro-stat-label">Tipos de Gr√°ficos</div>
                        </div>
                        <div class="intro-stat">
                            <div class="intro-stat-value">4</div>
                            <div class="intro-stat-label">√çndices de Capacidad</div>
                        </div>
                        <div class="intro-stat">
                            <div class="intro-stat-value">‚àû</div>
                            <div class="intro-stat-label">Ejercicios Pr√°cticos</div>
                        </div>
                    </div>
                </div>

                <div class="two-columns">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-icon">üìñ</span>
                            <div>
                                <h3 class="card-title">¬øQu√© es el SPC?</h3>
                                <span class="card-subtitle">Statistical Process Control</span>
                            </div>
                        </div>
                        <p>El <strong>Control Estad√≠stico de Procesos (SPC)</strong> es un conjunto de herramientas estad√≠sticas que permiten monitorear, controlar y mejorar los procesos de producci√≥n mediante el an√°lisis de la variabilidad.</p>

                        <div class="info-box" style="margin-top: 20px;">
                            <strong>üí° Concepto Clave:</strong> Todo proceso tiene variabilidad. El SPC nos ayuda a distinguir entre:
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Causas comunes:</strong> Variaci√≥n inherente al proceso (aleatoria)</li>
                                <li><strong>Causas especiales:</strong> Variaci√≥n asignable a factores espec√≠ficos</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span class="card-icon">üè≠</span>
                            <div>
                                <h3 class="card-title">Aplicaciones en Industria</h3>
                                <span class="card-subtitle">Casos de uso reales</span>
                            </div>
                        </div>
                        <div class="steps-container">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>Manufactura</h4>
                                    <p>Control de dimensiones, peso, resistencia de productos</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>Farmac√©utica</h4>
                                    <p>Monitoreo de concentraci√≥n, pureza y dosificaci√≥n</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>Alimentos</h4>
                                    <p>Control de temperatura, humedad, peso de empaque</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h4>Servicios</h4>
                                    <p>Tiempos de atenci√≥n, errores en procesos, satisfacci√≥n</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üó∫Ô∏è</span>
                        <div>
                            <h3 class="card-title">Mapa de Contenidos</h3>
                            <span class="card-subtitle">Tu ruta de aprendizaje</span>
                        </div>
                    </div>
                    <div class="chart-types-grid">
                        <div class="chart-type-card" onclick="showTab('control-charts')">
                            <div class="chart-type-icon">üìà</div>
                            <div class="chart-type-name">Gr√°ficos de Control</div>
                            <div class="chart-type-desc">Aprende a construir e interpretar gr√°ficos XÃÑ, R, S, p, np, c y u para monitorear procesos.</div>
                        </div>
                        <div class="chart-type-card" onclick="showTab('capability')">
                            <div class="chart-type-icon">üéØ</div>
                            <div class="chart-type-name">Capacidad de Proceso</div>
                            <div class="chart-type-desc">Domina los √≠ndices Cp, Cpk, Pp y Ppk para evaluar la capacidad de tus procesos.</div>
                        </div>
                        <div class="chart-type-card" onclick="showTab('tools')">
                            <div class="chart-type-icon">üîß</div>
                            <div class="chart-type-name">Herramientas de Calidad</div>
                            <div class="chart-type-desc">Diagrama de Pareto, Ishikawa, Histogramas y m√°s herramientas esenciales.</div>
                        </div>
                        <div class="chart-type-card" onclick="showTab('exercises')">
                            <div class="chart-type-icon">‚úèÔ∏è</div>
                            <div class="chart-type-name">Ejercicios Pr√°cticos</div>
                            <div class="chart-type-desc">Practica con problemas reales de ingenier√≠a industrial y gana puntos.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Control Charts -->
            <div id="control-charts" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìà</span>
                        <div>
                            <h3 class="card-title">Gr√°ficos de Control</h3>
                            <span class="card-subtitle">Herramienta fundamental del SPC</span>
                        </div>
                    </div>

                    <p>Los gr√°ficos de control son representaciones gr√°ficas de una caracter√≠stica de calidad medida o calculada a partir de muestras contra el n√∫mero de muestra o el tiempo. Permiten distinguir entre variaci√≥n por causas comunes y causas especiales.</p>

                    <div class="formula-box">
                        <p><strong>Estructura b√°sica de un gr√°fico de control:</strong></p>
                        <div class="formula">UCL = Œº + kœÉ &nbsp;&nbsp;|&nbsp;&nbsp; CL = Œº &nbsp;&nbsp;|&nbsp;&nbsp; LCL = Œº - kœÉ</div>
                        <p class="formula-description">Donde k = 3 para l√≠mites de control 3-sigma (99.73% de los datos)</p>
                    </div>

                    <div style="display: flex; gap: 30px; justify-content: center; margin: 20px 0;">
                        <div class="limit-indicator">
                            <div class="limit-line ucl"></div>
                            <span>UCL - L√≠mite de Control Superior</span>
                        </div>
                        <div class="limit-indicator">
                            <div class="limit-line cl"></div>
                            <span>CL - L√≠nea Central</span>
                        </div>
                        <div class="limit-indicator">
                            <div class="limit-line lcl"></div>
                            <span>LCL - L√≠mite de Control Inferior</span>
                        </div>
                    </div>
                </div>

                <h2 class="section-title">Tipos de Gr√°ficos de Control</h2>

                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--primary-light);">üìä Gr√°ficos para Variables (Datos Continuos)</h3>
                    <div class="chart-types-grid">
                        <div class="chart-type-card" onclick="showChartDetail('xbar-r')">
                            <div class="chart-type-icon">üìâ</div>
                            <div class="chart-type-name">Gr√°fico XÃÑ - R</div>
                            <div class="chart-type-full-name">Media y Rango</div>
                            <div class="chart-type-desc">Monitorea la media del proceso y la variabilidad mediante el rango.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> n ‚â§ 10 muestras por subgrupo</div>
                        </div>
                        <div class="chart-type-card" onclick="showChartDetail('xbar-s')">
                            <div class="chart-type-icon">üìä</div>
                            <div class="chart-type-name">Gr√°fico XÃÑ - S</div>
                            <div class="chart-type-full-name">Media y Desviaci√≥n Est√°ndar</div>
                            <div class="chart-type-desc">Similar al XÃÑ-R pero usa desviaci√≥n est√°ndar para mayor precisi√≥n.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> n > 10 muestras por subgrupo</div>
                        </div>
                        <div class="chart-type-card" onclick="showChartDetail('individual')">
                            <div class="chart-type-icon">üìà</div>
                            <div class="chart-type-name">Gr√°fico I-MR</div>
                            <div class="chart-type-full-name">Individual y Rango M√≥vil</div>
                            <div class="chart-type-desc">Para datos individuales cuando no es posible formar subgrupos.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> n = 1 (mediciones individuales)</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px; color: var(--secondary-light);">üìã Gr√°ficos para Atributos (Datos Discretos)</h3>
                    <div class="chart-types-grid">
                        <div class="chart-type-card" onclick="showChartDetail('p')">
                            <div class="chart-type-icon">üìå</div>
                            <div class="chart-type-name">Gr√°fico p</div>
                            <div class="chart-type-full-name">Proporci√≥n de Defectuosos</div>
                            <div class="chart-type-desc">Monitorea la fracci√≥n o porcentaje de unidades defectuosas.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> Tama√±o de muestra variable</div>
                        </div>
                        <div class="chart-type-card" onclick="showChartDetail('np')">
                            <div class="chart-type-icon">üî¢</div>
                            <div class="chart-type-name">Gr√°fico np</div>
                            <div class="chart-type-full-name">N√∫mero de Defectuosos</div>
                            <div class="chart-type-desc">Monitorea el n√∫mero absoluto de unidades defectuosas.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> Tama√±o de muestra constante</div>
                        </div>
                        <div class="chart-type-card" onclick="showChartDetail('c')">
                            <div class="chart-type-icon">‚ö†Ô∏è</div>
                            <div class="chart-type-name">Gr√°fico c</div>
                            <div class="chart-type-full-name">N√∫mero de Defectos</div>
                            <div class="chart-type-desc">Cuenta el n√∫mero de defectos por unidad de inspecci√≥n.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> √Årea de oportunidad constante</div>
                        </div>
                        <div class="chart-type-card" onclick="showChartDetail('u')">
                            <div class="chart-type-icon">üìê</div>
                            <div class="chart-type-name">Gr√°fico u</div>
                            <div class="chart-type-full-name">Defectos por Unidad</div>
                            <div class="chart-type-desc">Tasa de defectos por unidad de inspecci√≥n.</div>
                            <div class="chart-type-use"><strong>Usar cuando:</strong> √Årea de oportunidad variable</div>
                        </div>
                    </div>
                </div>

                <!-- Detail Section for X-bar R Chart -->
                <div id="xbar-r-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìâ</span>
                        <div>
                            <h3 class="card-title">Gr√°fico XÃÑ - R (Media y Rango)</h3>
                            <span class="card-subtitle">El gr√°fico de control m√°s utilizado</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('xbar-r')" style="margin-bottom: 20px;">‚Üê Volver a tipos</button>

                    <div class="two-columns">
                        <div>
                            <h4 class="section-title">F√≥rmulas del Gr√°fico XÃÑ</h4>
                            <div class="formula-box">
                                <div class="formula">XÃø = (Œ£ XÃÑ·µ¢) / k</div>
                                <p class="formula-description">L√≠nea central: Promedio de las medias de los subgrupos</p>
                            </div>
                            <div class="formula-box">
                                <div class="formula">UCL = XÃø + A‚ÇÇRÃÑ</div>
                                <div class="formula">LCL = XÃø - A‚ÇÇRÃÑ</div>
                                <p class="formula-description">A‚ÇÇ depende del tama√±o de subgrupo n</p>
                            </div>
                        </div>
                        <div>
                            <h4 class="section-title">F√≥rmulas del Gr√°fico R</h4>
                            <div class="formula-box">
                                <div class="formula">RÃÑ = (Œ£ R·µ¢) / k</div>
                                <p class="formula-description">L√≠nea central: Promedio de los rangos</p>
                            </div>
                            <div class="formula-box">
                                <div class="formula">UCL = D‚ÇÑRÃÑ</div>
                                <div class="formula">LCL = D‚ÇÉRÃÑ</div>
                                <p class="formula-description">D‚ÇÉ y D‚ÇÑ dependen del tama√±o de subgrupo n</p>
                            </div>
                        </div>
                    </div>

                    <h4 class="section-title">Constantes para Gr√°ficos XÃÑ-R</h4>
                    <div style="overflow-x: auto;">
                        <table class="data-table constants-table">
                            <thead>
                                <tr>
                                    <th>n</th>
                                    <th>A‚ÇÇ</th>
                                    <th>D‚ÇÉ</th>
                                    <th>D‚ÇÑ</th>
                                    <th>d‚ÇÇ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>2</td><td>1.880</td><td>0</td><td>3.267</td><td>1.128</td></tr>
                                <tr><td>3</td><td>1.023</td><td>0</td><td>2.574</td><td>1.693</td></tr>
                                <tr><td>4</td><td>0.729</td><td>0</td><td>2.282</td><td>2.059</td></tr>
                                <tr><td>5</td><td>0.577</td><td>0</td><td>2.114</td><td>2.326</td></tr>
                                <tr><td>6</td><td>0.483</td><td>0</td><td>2.004</td><td>2.534</td></tr>
                                <tr><td>7</td><td>0.419</td><td>0.076</td><td>1.924</td><td>2.704</td></tr>
                                <tr><td>8</td><td>0.373</td><td>0.136</td><td>1.864</td><td>2.847</td></tr>
                                <tr><td>9</td><td>0.337</td><td>0.184</td><td>1.816</td><td>2.970</td></tr>
                                <tr><td>10</td><td>0.308</td><td>0.223</td><td>1.777</td><td>3.078</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h4 class="section-title">Simulador Interactivo XÃÑ-R</h4>
                    <div class="controls-panel">
                        <div class="control-group">
                            <label class="control-label">Tama√±o de subgrupo (n)</label>
                            <select id="xbarRSubgroupSize" class="control-input" onchange="updateXbarRChart()">
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Media del proceso (Œº)</label>
                            <input type="number" id="xbarRMean" class="control-input" value="50" onchange="updateXbarRChart()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Desviaci√≥n est√°ndar (œÉ)</label>
                            <input type="number" id="xbarRSigma" class="control-input" value="2" step="0.1" onchange="updateXbarRChart()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">N√∫mero de subgrupos</label>
                            <input type="number" id="xbarRSubgroups" class="control-input" value="20" min="10" max="30" onchange="updateXbarRChart()">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateXbarRData()">üîÑ Generar Nuevos Datos</button>
                        <button class="btn btn-accent" onclick="addOutOfControl()">‚ö†Ô∏è Agregar Punto Fuera de Control</button>
                    </div>

                    <div class="two-columns">
                        <div class="chart-container">
                            <h4 style="text-align: center; margin-bottom: 15px;">Gr√°fico XÃÑ (Medias)</h4>
                            <div class="chart-wrapper">
                                <canvas id="xbarChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 style="text-align: center; margin-bottom: 15px;">Gr√°fico R (Rangos)</h4>
                            <div class="chart-wrapper">
                                <canvas id="rChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üìä Resultados del An√°lisis:</strong>
                        <div id="xbarRResults" style="margin-top: 10px;">
                            <p>Genera datos para ver los resultados del an√°lisis.</p>
                        </div>
                    </div>

                    <!-- Exercise for X-bar R -->
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">1</div>
                            <div class="exercise-title">Ejercicio: C√°lculo de L√≠mites XÃÑ-R</div>
                        </div>
                        <div class="exercise-content">
                            <p>Una empresa manufacturera toma 20 subgrupos de 5 muestras cada uno. Los resultados son:</p>
                            <ul style="margin: 15px 0 15px 25px;">
                                <li>Promedio de las medias (XÃø) = 25.3 mm</li>
                                <li>Promedio de los rangos (RÃÑ) = 4.2 mm</li>
                            </ul>
                            <p><strong>¬øCu√°l es el L√≠mite de Control Superior (UCL) para el gr√°fico XÃÑ?</strong></p>
                            <p style="font-size: 13px; color: var(--text-secondary);">Recuerda: Para n=5, A‚ÇÇ = 0.577</p>
                        </div>
                        <div class="exercise-options" id="exercise1Options">
                            <div class="exercise-option" onclick="checkExercise(1, 'a', this)">
                                <strong>A)</strong> 27.72 mm
                            </div>
                            <div class="exercise-option" onclick="checkExercise(1, 'b', this)">
                                <strong>B)</strong> 26.45 mm
                            </div>
                            <div class="exercise-option" onclick="checkExercise(1, 'c', this)">
                                <strong>C)</strong> 29.14 mm
                            </div>
                            <div class="exercise-option" onclick="checkExercise(1, 'd', this)">
                                <strong>D)</strong> 25.30 mm
                            </div>
                        </div>
                        <div id="exercise1Feedback" class="exercise-feedback"></div>
                    </div>

                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">2</div>
                            <div class="exercise-title">Ejercicio: Interpretaci√≥n del Gr√°fico</div>
                        </div>
                        <div class="exercise-content">
                            <p>Al analizar un gr√°fico XÃÑ-R, observas que un punto en el gr√°fico R est√° por encima del UCL, pero todos los puntos en el gr√°fico XÃÑ est√°n dentro de los l√≠mites.</p>
                            <p><strong>¬øQu√© indica esta situaci√≥n?</strong></p>
                        </div>
                        <div class="exercise-options" id="exercise2Options">
                            <div class="exercise-option" onclick="checkExercise(2, 'a', this)">
                                <strong>A)</strong> El proceso est√° bajo control estad√≠stico
                            </div>
                            <div class="exercise-option" onclick="checkExercise(2, 'b', this)">
                                <strong>B)</strong> La media del proceso ha cambiado
                            </div>
                            <div class="exercise-option" onclick="checkExercise(2, 'c', this)">
                                <strong>C)</strong> La variabilidad del proceso ha aumentado en ese subgrupo
                            </div>
                            <div class="exercise-option" onclick="checkExercise(2, 'd', this)">
                                <strong>D)</strong> Se debe aumentar el tama√±o de muestra
                            </div>
                        </div>
                        <div id="exercise2Feedback" class="exercise-feedback"></div>
                    </div>
                </div>

                <!-- Detail Section for p Chart -->
                <div id="p-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìå</span>
                        <div>
                            <h3 class="card-title">Gr√°fico p (Proporci√≥n de Defectuosos)</h3>
                            <span class="card-subtitle">Control de atributos con tama√±o de muestra variable</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('p')" style="margin-bottom: 20px;">‚Üê Volver a tipos</button>

                    <p>El gr√°fico p se utiliza cuando se inspecciona una muestra y cada unidad se clasifica como <strong>conforme</strong> o <strong>no conforme</strong> (defectuosa). Monitorea la proporci√≥n de unidades defectuosas.</p>

                    <div class="formula-box">
                        <p><strong>Proporci√≥n de defectuosos:</strong></p>
                        <div class="formula">pÃÑ = (Œ£ d·µ¢) / (Œ£ n·µ¢)</div>
                        <p class="formula-description">Donde d·µ¢ = defectuosos en muestra i, n·µ¢ = tama√±o de muestra i</p>
                    </div>

                    <div class="two-columns">
                        <div class="formula-box">
                            <p><strong>L√≠mite de Control Superior:</strong></p>
                            <div class="formula">UCL = pÃÑ + 3‚àö(pÃÑ(1-pÃÑ)/n)</div>
                        </div>
                        <div class="formula-box">
                            <p><strong>L√≠mite de Control Inferior:</strong></p>
                            <div class="formula">LCL = pÃÑ - 3‚àö(pÃÑ(1-pÃÑ)/n)</div>
                            <p class="formula-description">Si LCL < 0, usar LCL = 0</p>
                        </div>
                    </div>

                    <div class="info-box warning">
                        <strong>‚ö†Ô∏è Importante:</strong> Cuando el tama√±o de muestra var√≠a, los l√≠mites de control cambian para cada muestra. Esto crea l√≠mites "escalonados" en el gr√°fico.
                    </div>

                    <h4 class="section-title">Simulador Gr√°fico p</h4>
                    <div class="controls-panel">
                        <div class="control-group">
                            <label class="control-label">Proporci√≥n objetivo (pÃÑ)</label>
                            <input type="number" id="pChartProportion" class="control-input" value="0.05" step="0.01" min="0.01" max="0.3">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Tama√±o promedio de muestra</label>
                            <input type="number" id="pChartSampleSize" class="control-input" value="100" min="50" max="500">
                        </div>
                        <div class="control-group">
                            <label class="control-label">N√∫mero de muestras</label>
                            <input type="number" id="pChartSamples" class="control-input" value="25" min="15" max="40">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generatePChartData()">üîÑ Generar Datos</button>
                    </div>

                    <div class="chart-container">
                        <h4 style="text-align: center; margin-bottom: 15px;">Gr√°fico p - Proporci√≥n de Defectuosos</h4>
                        <div class="chart-wrapper">
                            <canvas id="pChart"></canvas>
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>üìä Resultados:</strong>
                        <div id="pChartResults" style="margin-top: 10px;">
                            <p>Genera datos para ver el an√°lisis.</p>
                        </div>
                    </div>

                    <!-- Exercise for p Chart -->
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">3</div>
                            <div class="exercise-title">Ejercicio: Gr√°fico p</div>
                        </div>
                        <div class="exercise-content">
                            <p>En una l√≠nea de producci√≥n se inspeccionan 200 unidades por hora. Los datos de 10 horas muestran un total de 45 unidades defectuosas.</p>
                            <p><strong>¬øCu√°l es la proporci√≥n promedio de defectuosos (pÃÑ)?</strong></p>
                        </div>
                        <div class="exercise-options" id="exercise3Options">
                            <div class="exercise-option" onclick="checkExercise(3, 'a', this)">
                                <strong>A)</strong> 0.045
                            </div>
                            <div class="exercise-option" onclick="checkExercise(3, 'b', this)">
                                <strong>B)</strong> 0.0225
                            </div>
                            <div class="exercise-option" onclick="checkExercise(3, 'c', this)">
                                <strong>C)</strong> 0.225
                            </div>
                            <div class="exercise-option" onclick="checkExercise(3, 'd', this)">
                                <strong>D)</strong> 4.5
                            </div>
                        </div>
                        <div id="exercise3Feedback" class="exercise-feedback"></div>
                    </div>
                </div>

                <!-- Placeholders for other chart details -->
                <div id="xbar-s-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <div>
                            <h3 class="card-title">Gr√°fico XÃÑ - S</h3>
                            <span class="card-subtitle">En construcci√≥n</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('xbar-s')" style="margin-bottom: 20px;">‚Üê Volver</button>
                    <p>Contenido detallado del gr√°fico XÃÑ-S pr√≥ximamente...</p>
                </div>

                <div id="individual-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìà</span>
                        <div>
                            <h3 class="card-title">Gr√°fico I-MR</h3>
                            <span class="card-subtitle">En construcci√≥n</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('individual')" style="margin-bottom: 20px;">‚Üê Volver</button>
                    <p>Contenido detallado del gr√°fico I-MR pr√≥ximamente...</p>
                </div>

                <div id="np-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üî¢</span>
                        <div>
                            <h3 class="card-title">Gr√°fico np</h3>
                            <span class="card-subtitle">En construcci√≥n</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('np')" style="margin-bottom: 20px;">‚Üê Volver</button>
                    <p>Contenido detallado del gr√°fico np pr√≥ximamente...</p>
                </div>

                <div id="c-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">‚ö†Ô∏è</span>
                        <div>
                            <h3 class="card-title">Gr√°fico c</h3>
                            <span class="card-subtitle">En construcci√≥n</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('c')" style="margin-bottom: 20px;">‚Üê Volver</button>
                    <p>Contenido detallado del gr√°fico c pr√≥ximamente...</p>
                </div>

                <div id="u-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìê</span>
                        <div>
                            <h3 class="card-title">Gr√°fico u</h3>
                            <span class="card-subtitle">En construcci√≥n</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideChartDetail('u')" style="margin-bottom: 20px;">‚Üê Volver</button>
                    <p>Contenido detallado del gr√°fico u pr√≥ximamente...</p>
                </div>
            </div>

            <!-- Tab: Process Capability -->
            <div id="capability" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üéØ</span>
                        <div>
                            <h3 class="card-title">Capacidad de Proceso</h3>
                            <span class="card-subtitle">¬øPuede el proceso cumplir especificaciones?</span>
                        </div>
                    </div>

                    <p>La <strong>capacidad de proceso</strong> mide qu√© tan bien un proceso puede producir dentro de los l√≠mites de especificaci√≥n establecidos. Los √≠ndices de capacidad comparan la variabilidad del proceso con las tolerancias permitidas.</p>

                    <div class="info-box">
                        <strong>üí° Concepto Clave:</strong> La capacidad de proceso solo tiene sentido cuando el proceso est√° <strong>bajo control estad√≠stico</strong> (sin causas especiales de variaci√≥n).
                    </div>
                </div>

                <div class="two-columns">
                    <div class="card">
                        <h3 style="margin-bottom: 20px; color: var(--primary-light);">üìè √çndices de Capacidad Potencial</h3>

                        <div class="formula-box">
                            <p><strong>Cp - Capacidad Potencial:</strong></p>
                            <div class="formula">Cp = (USL - LSL) / 6œÉ</div>
                            <p class="formula-description">Compara el ancho de especificaci√≥n con la dispersi√≥n del proceso</p>
                        </div>

                        <div class="info-box">
                            <strong>Interpretaci√≥n de Cp:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Cp ‚â• 1.33:</strong> Proceso capaz ‚úÖ</li>
                                <li><strong>1.00 ‚â§ Cp < 1.33:</strong> Proceso marginal ‚ö†Ô∏è</li>
                                <li><strong>Cp < 1.00:</strong> Proceso incapaz ‚ùå</li>
                            </ul>
                        </div>

                        <div class="formula-box" style="margin-top: 20px;">
                            <p><strong>Pp - Desempe√±o Potencial:</strong></p>
                            <div class="formula">Pp = (USL - LSL) / 6s</div>
                            <p class="formula-description">Usa desviaci√≥n est√°ndar total (incluye variaci√≥n entre subgrupos)</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="margin-bottom: 20px; color: var(--secondary-light);">üéØ √çndices de Capacidad Real</h3>

                        <div class="formula-box">
                            <p><strong>Cpk - Capacidad Real:</strong></p>
                            <div class="formula">Cpk = min[(USL - Œº)/3œÉ, (Œº - LSL)/3œÉ]</div>
                            <p class="formula-description">Considera el centrado del proceso</p>
                        </div>

                        <div class="info-box warning">
                            <strong>‚ö†Ô∏è Diferencia clave:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Cp:</strong> Mide capacidad potencial (si el proceso estuviera centrado)</li>
                                <li><strong>Cpk:</strong> Mide capacidad real (considera descentrado)</li>
                                <li>Cpk ‚â§ Cp siempre</li>
                            </ul>
                        </div>

                        <div class="formula-box" style="margin-top: 20px;">
                            <p><strong>Ppk - Desempe√±o Real:</strong></p>
                            <div class="formula">Ppk = min[(USL - Œº)/3s, (Œº - LSL)/3s]</div>
                            <p class="formula-description">Desempe√±o real con variaci√≥n total</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="section-title">Comparaci√≥n Cp vs Cpk</h3>
                    <div class="distribution-visual">
                        <div id="capabilityComparison" style="height: 300px;"></div>
                    </div>
                    <div class="controls-panel">
                        <div class="control-group">
                            <label class="control-label">LSL (L√≠mite Inferior)</label>
                            <input type="number" id="capLSL" class="control-input" value="45" onchange="updateCapabilityChart()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">USL (L√≠mite Superior)</label>
                            <input type="number" id="capUSL" class="control-input" value="55" onchange="updateCapabilityChart()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Media del proceso (Œº)</label>
                            <input type="number" id="capMean" class="control-input" value="50" step="0.5" onchange="updateCapabilityChart()">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Desviaci√≥n est√°ndar (œÉ)</label>
                            <input type="number" id="capSigma" class="control-input" value="1.5" step="0.1" onchange="updateCapabilityChart()">
                        </div>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Ajustar Media del Proceso</span>
                            <span id="sliderMeanValue">50</span>
                        </div>
                        <input type="range" class="slider" id="meanSlider" min="44" max="56" step="0.5" value="50" oninput="updateFromSlider()">
                    </div>

                    <div class="capability-grid" id="capabilityResults">
                        <div class="capability-indicator">
                            <div class="capability-value good" id="cpValue">1.11</div>
                            <div class="capability-label">Cp</div>
                            <span class="capability-status good">Potencial</span>
                        </div>
                        <div class="capability-indicator">
                            <div class="capability-value good" id="cpkValue">1.11</div>
                            <div class="capability-label">Cpk</div>
                            <span class="capability-status good">Real</span>
                        </div>
                        <div class="capability-indicator">
                            <div class="capability-value" id="cpuValue">1.11</div>
                            <div class="capability-label">Cpu</div>
                            <span class="capability-status">Superior</span>
                        </div>
                        <div class="capability-indicator">
                            <div class="capability-value" id="cplValue">1.11</div>
                            <div class="capability-label">Cpl</div>
                            <span class="capability-status">Inferior</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="section-title">Tabla de Referencia de Capacidad</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Cpk</th>
                                <th>Nivel Sigma</th>
                                <th>PPM Defectuosos</th>
                                <th>% Conforme</th>
                                <th>Calificaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0.33</td>
                                <td>1œÉ</td>
                                <td>317,400</td>
                                <td>68.27%</td>
                                <td style="color: var(--danger);">Muy Incapaz</td>
                            </tr>
                            <tr>
                                <td>0.67</td>
                                <td>2œÉ</td>
                                <td>45,500</td>
                                <td>95.45%</td>
                                <td style="color: var(--danger);">Incapaz</td>
                            </tr>
                            <tr>
                                <td>1.00</td>
                                <td>3œÉ</td>
                                <td>2,700</td>
                                <td>99.73%</td>
                                <td style="color: var(--warning);">M√≠nimo Aceptable</td>
                            </tr>
                            <tr>
                                <td>1.33</td>
                                <td>4œÉ</td>
                                <td>63</td>
                                <td>99.9937%</td>
                                <td style="color: var(--success);">Capaz</td>
                            </tr>
                            <tr>
                                <td>1.67</td>
                                <td>5œÉ</td>
                                <td>0.57</td>
                                <td>99.999943%</td>
                                <td style="color: var(--success);">Muy Capaz</td>
                            </tr>
                            <tr>
                                <td>2.00</td>
                                <td>6œÉ</td>
                                <td>0.002</td>
                                <td>99.9999998%</td>
                                <td style="color: var(--success);">Clase Mundial</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Exercises for Capability -->
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-number">4</div>
                        <div class="exercise-title">Ejercicio: C√°lculo de Cp</div>
                    </div>
                    <div class="exercise-content">
                        <p>Un proceso de llenado tiene las siguientes especificaciones:</p>
                        <ul style="margin: 15px 0 15px 25px;">
                            <li>LSL = 495 ml</li>
                            <li>USL = 505 ml</li>
                            <li>Desviaci√≥n est√°ndar del proceso (œÉ) = 1.2 ml</li>
                        </ul>
                        <p><strong>¬øCu√°l es el √≠ndice de capacidad potencial Cp?</strong></p>
                    </div>
                    <div class="exercise-options" id="exercise4Options">
                        <div class="exercise-option" onclick="checkExercise(4, 'a', this)">
                            <strong>A)</strong> 1.39
                        </div>
                        <div class="exercise-option" onclick="checkExercise(4, 'b', this)">
                            <strong>B)</strong> 1.67
                        </div>
                        <div class="exercise-option" onclick="checkExercise(4, 'c', this)">
                            <strong>C)</strong> 0.83
                        </div>
                        <div class="exercise-option" onclick="checkExercise(4, 'd', this)">
                            <strong>D)</strong> 1.25
                        </div>
                    </div>
                    <div id="exercise4Feedback" class="exercise-feedback"></div>
                </div>

                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-number">5</div>
                        <div class="exercise-title">Ejercicio: Interpretaci√≥n Cp vs Cpk</div>
                    </div>
                    <div class="exercise-content">
                        <p>Un an√°lisis de capacidad muestra los siguientes resultados:</p>
                        <ul style="margin: 15px 0 15px 25px;">
                            <li>Cp = 1.50</li>
                            <li>Cpk = 0.75</li>
                        </ul>
                        <p><strong>¬øQu√© se puede concluir sobre este proceso?</strong></p>
                    </div>
                    <div class="exercise-options" id="exercise5Options">
                        <div class="exercise-option" onclick="checkExercise(5, 'a', this)">
                            <strong>A)</strong> El proceso es capaz y est√° centrado
                        </div>
                        <div class="exercise-option" onclick="checkExercise(5, 'b', this)">
                            <strong>B)</strong> El proceso tiene potencial pero est√° descentrado
                        </div>
                        <div class="exercise-option" onclick="checkExercise(5, 'c', this)">
                            <strong>C)</strong> El proceso es incapaz y debe reducir variabilidad
                        </div>
                        <div class="exercise-option" onclick="checkExercise(5, 'd', this)">
                            <strong>D)</strong> Los l√≠mites de especificaci√≥n est√°n mal definidos
                        </div>
                    </div>
                    <div id="exercise5Feedback" class="exercise-feedback"></div>
                </div>

                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-number">6</div>
                        <div class="exercise-title">Ejercicio: C√°lculo de Cpk</div>
                    </div>
                    <div class="exercise-content">
                        <p>Para un proceso de manufactura:</p>
                        <ul style="margin: 15px 0 15px 25px;">
                            <li>Especificaci√≥n: 100 ¬± 5 mm (LSL=95, USL=105)</li>
                            <li>Media del proceso (Œº) = 102 mm</li>
                            <li>Desviaci√≥n est√°ndar (œÉ) = 1.5 mm</li>
                        </ul>
                        <p><strong>¬øCu√°l es el valor de Cpk?</strong></p>
                    </div>
                    <div class="exercise-options" id="exercise6Options">
                        <div class="exercise-option" onclick="checkExercise(6, 'a', this)">
                            <strong>A)</strong> 1.11
                        </div>
                        <div class="exercise-option" onclick="checkExercise(6, 'b', this)">
                            <strong>B)</strong> 0.67
                        </div>
                        <div class="exercise-option" onclick="checkExercise(6, 'c', this)">
                            <strong>C)</strong> 1.56
                        </div>
                        <div class="exercise-option" onclick="checkExercise(6, 'd', this)">
                            <strong>D)</strong> 1.33
                        </div>
                    </div>
                    <div id="exercise6Feedback" class="exercise-feedback"></div>
                </div>
            </div>

            <!-- Tab: Quality Tools -->
            <div id="tools" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîß</span>
                        <div>
                            <h3 class="card-title">Las 7 Herramientas B√°sicas de Calidad</h3>
                            <span class="card-subtitle">Herramientas fundamentales para la mejora continua</span>
                        </div>
                    </div>
                    <p>Las <strong>7 herramientas b√°sicas de calidad</strong> fueron recopiladas por Kaoru Ishikawa en los a√±os 60. Son t√©cnicas gr√°ficas que ayudan a identificar, analizar y resolver problemas de calidad.</p>

                    <div class="chart-types-grid" style="margin-top: 25px;">
                        <div class="chart-type-card" onclick="showToolDetail('pareto')">
                            <div class="chart-type-icon">üìä</div>
                            <div class="chart-type-name">Diagrama de Pareto</div>
                            <div class="chart-type-desc">Identifica los "pocos vitales" vs "muchos triviales". El 80% de los problemas provienen del 20% de las causas.</div>
                        </div>
                        <div class="chart-type-card" onclick="showToolDetail('ishikawa')">
                            <div class="chart-type-icon">üêü</div>
                            <div class="chart-type-name">Diagrama de Ishikawa</div>
                            <div class="chart-type-desc">An√°lisis causa-efecto. Organiza las posibles causas de un problema en categor√≠as (6M).</div>
                        </div>
                        <div class="chart-type-card" onclick="showToolDetail('histogram')">
                            <div class="chart-type-icon">üìà</div>
                            <div class="chart-type-name">Histograma</div>
                            <div class="chart-type-desc">Visualiza la distribuci√≥n de datos y detecta patrones, sesgos o bimodalidad.</div>
                        </div>
                        <div class="chart-type-card" onclick="showToolDetail('scatter')">
                            <div class="chart-type-icon">üîÄ</div>
                            <div class="chart-type-name">Diagrama de Dispersi√≥n</div>
                            <div class="chart-type-desc">Analiza la relaci√≥n entre dos variables. Identifica correlaciones.</div>
                        </div>
                    </div>
                </div>

                <!-- Pareto Detail -->
                <div id="pareto-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <div>
                            <h3 class="card-title">Diagrama de Pareto</h3>
                            <span class="card-subtitle">Principio 80/20 - Vilfredo Pareto</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideToolDetail('pareto')" style="margin-bottom: 20px;">‚Üê Volver a herramientas</button>

                    <div class="two-columns">
                        <div>
                            <h4 class="section-title">¬øQu√© es?</h4>
                            <p>El diagrama de Pareto es un gr√°fico de barras ordenadas de mayor a menor, combinado con una l√≠nea de porcentaje acumulado. Se basa en el <strong>Principio de Pareto</strong>: aproximadamente el 80% de los efectos provienen del 20% de las causas.</p>

                            <div class="info-box" style="margin-top: 20px;">
                                <strong>üí° Aplicaci√≥n:</strong> Ayuda a priorizar esfuerzos enfoc√°ndose en los problemas que tienen mayor impacto. "Atacar primero a los pocos vitales".
                            </div>

                            <h4 class="section-title">Pasos para construirlo</h4>
                            <div class="steps-container">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Recolectar datos</h4>
                                        <p>Identificar categor√≠as y contar frecuencias</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Ordenar de mayor a menor</h4>
                                        <p>Por frecuencia o impacto econ√≥mico</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Calcular porcentajes</h4>
                                        <p>Individual y acumulado</p>
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <h4>Graficar</h4>
                                        <p>Barras + l√≠nea acumulada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="section-title">Simulador Interactivo</h4>
                            <p style="margin-bottom: 15px;">Ingresa datos de defectos para generar un diagrama de Pareto:</p>

                            <div class="control-group">
                                <label class="control-label">Seleccionar ejemplo predefinido:</label>
                                <select id="paretoExample" class="control-input" onchange="loadParetoExample()">
                                    <option value="">-- Seleccionar --</option>
                                    <option value="defectos">Defectos de manufactura</option>
                                    <option value="quejas">Quejas de clientes</option>
                                    <option value="paradas">Paradas de m√°quina</option>
                                </select>
                            </div>

                            <div style="margin: 15px 0;">
                                <label class="control-label">O ingresa datos manualmente (Categor√≠a:Valor):</label>
                                <textarea id="paretoData" class="control-input" rows="6" placeholder="Rayones:45&#10;Burbujas:32&#10;Manchas:28&#10;Grietas:15&#10;Deformaciones:10&#10;Otros:8" style="resize: vertical;"></textarea>
                            </div>

                            <button class="btn btn-primary" onclick="generateParetoChart()">üìä Generar Diagrama</button>
                        </div>
                    </div>

                    <div class="chart-container" style="margin-top: 25px;">
                        <h4 style="text-align: center; margin-bottom: 15px;">Diagrama de Pareto</h4>
                        <div style="height: 400px;">
                            <canvas id="paretoChart"></canvas>
                        </div>
                    </div>

                    <div class="info-box" id="paretoAnalysis" style="display: none;">
                        <strong>üìä An√°lisis del Diagrama:</strong>
                        <div id="paretoAnalysisContent"></div>
                    </div>

                    <!-- Exercise Pareto -->
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">7</div>
                            <div class="exercise-title">Ejercicio: Interpretaci√≥n de Pareto</div>
                        </div>
                        <div class="exercise-content">
                            <p>En una f√°brica de envases, se registraron los siguientes defectos en un mes:</p>
                            <ul style="margin: 15px 0 15px 25px;">
                                <li>Fugas: 120 unidades</li>
                                <li>Deformaci√≥n: 85 unidades</li>
                                <li>Etiquetado: 45 unidades</li>
                                <li>Color: 30 unidades</li>
                                <li>Otros: 20 unidades</li>
                            </ul>
                            <p><strong>¬øQu√© porcentaje de defectos representan las dos categor√≠as principales?</strong></p>
                        </div>
                        <div class="exercise-options" id="exercise7Options">
                            <div class="exercise-option" onclick="checkExercise(7, 'a', this)">
                                <strong>A)</strong> 68.3%
                            </div>
                            <div class="exercise-option" onclick="checkExercise(7, 'b', this)">
                                <strong>B)</strong> 40.0%
                            </div>
                            <div class="exercise-option" onclick="checkExercise(7, 'c', this)">
                                <strong>C)</strong> 55.0%
                            </div>
                            <div class="exercise-option" onclick="checkExercise(7, 'd', this)">
                                <strong>D)</strong> 75.0%
                            </div>
                        </div>
                        <div id="exercise7Feedback" class="exercise-feedback"></div>
                    </div>
                </div>

                <!-- Ishikawa Detail -->
                <div id="ishikawa-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üêü</span>
                        <div>
                            <h3 class="card-title">Diagrama de Ishikawa (Causa-Efecto)</h3>
                            <span class="card-subtitle">Tambi√©n conocido como diagrama de espina de pescado</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideToolDetail('ishikawa')" style="margin-bottom: 20px;">‚Üê Volver a herramientas</button>

                    <p>El diagrama de Ishikawa es una herramienta gr√°fica que ayuda a identificar y organizar las posibles causas de un problema. Su forma recuerda el esqueleto de un pez, donde la "cabeza" es el problema y las "espinas" son las categor√≠as de causas.</p>

                    <div class="info-box" style="margin: 20px 0;">
                        <strong>üîß Las 6M (Categor√≠as tradicionales de manufactura):</strong>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div><strong>üë§ Mano de obra:</strong> Personal, capacitaci√≥n, fatiga</div>
                            <div><strong>‚öôÔ∏è M√°quina:</strong> Equipos, mantenimiento, calibraci√≥n</div>
                            <div><strong>üì¶ Material:</strong> Materia prima, insumos, proveedores</div>
                            <div><strong>üìã M√©todo:</strong> Procedimientos, instrucciones, est√°ndares</div>
                            <div><strong>üìè Medici√≥n:</strong> Instrumentos, inspecci√≥n, errores</div>
                            <div><strong>üå°Ô∏è Medio ambiente:</strong> Temperatura, humedad, iluminaci√≥n</div>
                        </div>
                    </div>

                    <h4 class="section-title">Constructor Interactivo de Ishikawa</h4>

                    <div class="controls-panel">
                        <div class="control-group" style="grid-column: span 2;">
                            <label class="control-label">Problema a analizar (Efecto):</label>
                            <input type="text" id="ishikawaEffect" class="control-input" placeholder="Ej: Alta tasa de productos defectuosos" value="Alta tasa de defectos">
                        </div>
                    </div>

                    <div class="two-columns" style="margin-top: 20px;">
                        <div>
                            <div class="control-group">
                                <label class="control-label">üë§ Mano de obra:</label>
                                <textarea id="ishikawaMano" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Falta de capacitaci√≥n
Fatiga del operador
Rotaci√≥n de personal</textarea>
                            </div>
                            <div class="control-group">
                                <label class="control-label">‚öôÔ∏è M√°quina:</label>
                                <textarea id="ishikawaMaquina" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Desgaste de componentes
Falta de mantenimiento
Descalibraci√≥n</textarea>
                            </div>
                            <div class="control-group">
                                <label class="control-label">üì¶ Material:</label>
                                <textarea id="ishikawaMaterial" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Variaci√≥n de proveedores
Material fuera de especificaci√≥n
Almacenamiento inadecuado</textarea>
                            </div>
                        </div>
                        <div>
                            <div class="control-group">
                                <label class="control-label">üìã M√©todo:</label>
                                <textarea id="ishikawaMetodo" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Procedimiento desactualizado
Instrucciones confusas
Falta de estandarizaci√≥n</textarea>
                            </div>
                            <div class="control-group">
                                <label class="control-label">üìè Medici√≥n:</label>
                                <textarea id="ishikawaMedicion" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Instrumentos sin calibrar
Error de lectura
Criterios subjetivos</textarea>
                            </div>
                            <div class="control-group">
                                <label class="control-label">üå°Ô∏è Medio ambiente:</label>
                                <textarea id="ishikawaMedio" class="control-input" rows="3" placeholder="Una causa por l√≠nea" style="resize: vertical;">Temperatura variable
Iluminaci√≥n deficiente
Ruido excesivo</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateIshikawa()">üêü Generar Diagrama</button>
                        <button class="btn btn-accent" onclick="clearIshikawa()">üóëÔ∏è Limpiar</button>
                    </div>

                    <div class="chart-container" style="margin-top: 25px;">
                        <h4 style="text-align: center; margin-bottom: 15px;">Diagrama de Ishikawa</h4>
                        <div id="ishikawaChart" style="height: 500px; background: rgba(0,0,0,0.2); border-radius: 12px; position: relative; overflow: hidden;"></div>
                    </div>

                    <!-- Exercise Ishikawa -->
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">8</div>
                            <div class="exercise-title">Ejercicio: Clasificaci√≥n de Causas</div>
                        </div>
                        <div class="exercise-content">
                            <p>Un equipo de mejora est√° analizando el problema de "Tiempo de ciclo excesivo". Identificaron la causa: <strong>"Operador no sigue el procedimiento est√°ndar"</strong>.</p>
                            <p><strong>¬øEn qu√© categor√≠a de las 6M se debe clasificar esta causa?</strong></p>
                        </div>
                        <div class="exercise-options" id="exercise8Options">
                            <div class="exercise-option" onclick="checkExercise(8, 'a', this)">
                                <strong>A)</strong> M√©todo
                            </div>
                            <div class="exercise-option" onclick="checkExercise(8, 'b', this)">
                                <strong>B)</strong> Mano de obra
                            </div>
                            <div class="exercise-option" onclick="checkExercise(8, 'c', this)">
                                <strong>C)</strong> M√°quina
                            </div>
                            <div class="exercise-option" onclick="checkExercise(8, 'd', this)">
                                <strong>D)</strong> Medici√≥n
                            </div>
                        </div>
                        <div id="exercise8Feedback" class="exercise-feedback"></div>
                    </div>
                </div>

                <!-- Histogram Detail -->
                <div id="histogram-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìà</span>
                        <div>
                            <h3 class="card-title">Histograma</h3>
                            <span class="card-subtitle">Visualizaci√≥n de la distribuci√≥n de datos</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideToolDetail('histogram')" style="margin-bottom: 20px;">‚Üê Volver a herramientas</button>

                    <p>El histograma es un gr√°fico de barras que muestra la <strong>distribuci√≥n de frecuencias</strong> de un conjunto de datos. Permite visualizar la forma, centro y dispersi√≥n de los datos.</p>

                    <div class="two-columns" style="margin-top: 20px;">
                        <div>
                            <h4 class="section-title">Patrones comunes</h4>
                            <div class="info-box">
                                <strong>üîî Normal (Campana):</strong> Proceso estable y predecible. Ideal.
                            </div>
                            <div class="info-box warning">
                                <strong>‚ÜîÔ∏è Sesgado:</strong> Proceso con tendencia hacia un lado. Investigar causa.
                            </div>
                            <div class="info-box danger">
                                <strong>üèîÔ∏èüèîÔ∏è Bimodal:</strong> Dos picos. Posible mezcla de dos procesos o poblaciones.
                            </div>
                            <div class="info-box">
                                <strong>‚úÇÔ∏è Truncado:</strong> Datos cortados. Posible inspecci√≥n 100% o selecci√≥n.
                            </div>
                        </div>
                        <div>
                            <h4 class="section-title">Generador de Histograma</h4>
                            <div class="control-group">
                                <label class="control-label">Tipo de distribuci√≥n:</label>
                                <select id="histogramType" class="control-input" onchange="generateHistogramData()">
                                    <option value="normal">Normal (ideal)</option>
                                    <option value="skewed-right">Sesgada derecha</option>
                                    <option value="skewed-left">Sesgada izquierda</option>
                                    <option value="bimodal">Bimodal</option>
                                    <option value="uniform">Uniforme</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">N√∫mero de datos:</label>
                                <input type="number" id="histogramN" class="control-input" value="200" min="50" max="500">
                            </div>
                            <div class="control-group">
                                <label class="control-label">N√∫mero de clases (bins):</label>
                                <input type="number" id="histogramBins" class="control-input" value="15" min="5" max="30">
                            </div>
                            <button class="btn btn-primary" onclick="generateHistogramData()" style="margin-top: 10px;">üìä Generar Histograma</button>
                        </div>
                    </div>

                    <div class="chart-container" style="margin-top: 25px;">
                        <div style="height: 350px;">
                            <canvas id="histogramChart"></canvas>
                        </div>
                    </div>

                    <div class="stats-bar" id="histogramStats">
                        <div class="stat-item">
                            <span class="stat-icon">üìä</span>
                            <div>
                                <div class="stat-value" id="histMean">--</div>
                                <div class="stat-label">Media</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üìè</span>
                            <div>
                                <div class="stat-value" id="histStd">--</div>
                                <div class="stat-label">Desv. Est.</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚¨áÔ∏è</span>
                            <div>
                                <div class="stat-value" id="histMin">--</div>
                                <div class="stat-label">M√≠nimo</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚¨ÜÔ∏è</span>
                            <div>
                                <div class="stat-value" id="histMax">--</div>
                                <div class="stat-label">M√°ximo</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scatter Detail -->
                <div id="scatter-detail" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üîÄ</span>
                        <div>
                            <h3 class="card-title">Diagrama de Dispersi√≥n</h3>
                            <span class="card-subtitle">An√°lisis de correlaci√≥n entre variables</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="hideToolDetail('scatter')" style="margin-bottom: 20px;">‚Üê Volver a herramientas</button>

                    <p>El diagrama de dispersi√≥n muestra la relaci√≥n entre dos variables. Permite identificar si existe <strong>correlaci√≥n</strong> (positiva, negativa o ninguna) entre ellas.</p>

                    <div class="two-columns" style="margin-top: 20px;">
                        <div>
                            <h4 class="section-title">Tipos de correlaci√≥n</h4>
                            <div class="info-box">
                                <strong>üìà Positiva fuerte:</strong> Cuando X aumenta, Y aumenta proporcionalmente. r ‚âà +1
                            </div>
                            <div class="info-box">
                                <strong>üìâ Negativa fuerte:</strong> Cuando X aumenta, Y disminuye proporcionalmente. r ‚âà -1
                            </div>
                            <div class="info-box warning">
                                <strong>‚òÅÔ∏è Sin correlaci√≥n:</strong> No hay relaci√≥n aparente. r ‚âà 0
                            </div>

                            <div class="formula-box" style="margin-top: 20px;">
                                <p><strong>Coeficiente de correlaci√≥n (r):</strong></p>
                                <div class="formula" style="font-size: 18px;">r = Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥) / ‚àö[Œ£(x·µ¢ - xÃÑ)¬≤ ¬∑ Œ£(y·µ¢ - »≥)¬≤]</div>
                                <p class="formula-description">-1 ‚â§ r ‚â§ +1</p>
                            </div>
                        </div>
                        <div>
                            <h4 class="section-title">Simulador Interactivo</h4>
                            <div class="control-group">
                                <label class="control-label">Tipo de correlaci√≥n:</label>
                                <select id="scatterType" class="control-input" onchange="generateScatterData()">
                                    <option value="positive-strong">Positiva fuerte (r ‚âà 0.9)</option>
                                    <option value="positive-weak">Positiva d√©bil (r ‚âà 0.5)</option>
                                    <option value="none">Sin correlaci√≥n (r ‚âà 0)</option>
                                    <option value="negative-weak">Negativa d√©bil (r ‚âà -0.5)</option>
                                    <option value="negative-strong">Negativa fuerte (r ‚âà -0.9)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">N√∫mero de puntos:</label>
                                <input type="number" id="scatterN" class="control-input" value="50" min="20" max="100">
                            </div>
                            <div class="control-group">
                                <label class="control-label">Ejemplo industrial:</label>
                                <select id="scatterExample" class="control-input" onchange="loadScatterExample()">
                                    <option value="">-- Seleccionar --</option>
                                    <option value="temp-defects">Temperatura vs Defectos</option>
                                    <option value="speed-quality">Velocidad vs Calidad</option>
                                    <option value="training-errors">Capacitaci√≥n vs Errores</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="generateScatterData()" style="margin-top: 10px;">üîÄ Generar Diagrama</button>
                        </div>
                    </div>

                    <div class="chart-container" style="margin-top: 25px;">
                        <div style="height: 400px;">
                            <canvas id="scatterChart"></canvas>
                        </div>
                    </div>

                    <div class="stats-bar" id="scatterStats">
                        <div class="stat-item">
                            <span class="stat-icon">üìä</span>
                            <div>
                                <div class="stat-value" id="correlationR">--</div>
                                <div class="stat-label">Coef. Correlaci√≥n (r)</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üìê</span>
                            <div>
                                <div class="stat-value" id="correlationR2">--</div>
                                <div class="stat-label">R¬≤ (Determinaci√≥n)</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üéØ</span>
                            <div>
                                <div class="stat-value" id="correlationInterpret">--</div>
                                <div class="stat-label">Interpretaci√≥n</div>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Scatter -->
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-number">9</div>
                            <div class="exercise-title">Ejercicio: Interpretaci√≥n de Correlaci√≥n</div>
                        </div>
                        <div class="exercise-content">
                            <p>Un an√°lisis de dispersi√≥n entre "Horas de capacitaci√≥n" y "N√∫mero de errores por semana" muestra un coeficiente de correlaci√≥n r = -0.85.</p>
                            <p><strong>¬øQu√© se puede concluir?</strong></p>
                        </div>
                        <div class="exercise-options" id="exercise9Options">
                            <div class="exercise-option" onclick="checkExercise(9, 'a', this)">
                                <strong>A)</strong> No existe relaci√≥n entre las variables
                            </div>
                            <div class="exercise-option" onclick="checkExercise(9, 'b', this)">
                                <strong>B)</strong> A mayor capacitaci√≥n, m√°s errores
                            </div>
                            <div class="exercise-option" onclick="checkExercise(9, 'c', this)">
                                <strong>C)</strong> A mayor capacitaci√≥n, menos errores (correlaci√≥n negativa fuerte)
                            </div>
                            <div class="exercise-option" onclick="checkExercise(9, 'd', this)">
                                <strong>D)</strong> La relaci√≥n es positiva y d√©bil
                            </div>
                        </div>
                        <div id="exercise9Feedback" class="exercise-feedback"></div>
                    </div>
                </div>
            </div>

            <!-- Tab: Exercises with Gamification -->
            <div id="exercises" class="tab-content">
                <!-- Player Stats Panel -->
                <div class="card" style="background: linear-gradient(135deg, rgba(13, 71, 161, 0.3) 0%, rgba(0, 137, 123, 0.2) 100%);">
                    <div class="stats-bar" style="margin: 0; padding: 0; background: transparent;">
                        <div class="stat-item">
                            <span class="stat-icon">‚≠ê</span>
                            <div>
                                <div class="stat-value" id="playerPoints">0</div>
                                <div class="stat-label">Puntos</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üìä</span>
                            <div>
                                <div class="stat-value" id="playerLevel">1</div>
                                <div class="stat-label">Nivel</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üî•</span>
                            <div>
                                <div class="stat-value" id="playerStreak">0</div>
                                <div class="stat-label">Racha</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚úÖ</span>
                            <div>
                                <div class="stat-value" id="playerCompleted">0</div>
                                <div class="stat-label">Completados</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üèÜ</span>
                            <div>
                                <div class="stat-value" id="playerAchievements">0/8</div>
                                <div class="stat-label">Logros</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div class="slider-label">
                            <span>Progreso al siguiente nivel</span>
                            <span id="xpProgress">0/100 XP</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div id="xpBar" style="background: var(--gradient-secondary); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Panel -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üèÜ</span>
                        <div>
                            <h3 class="card-title">Logros</h3>
                            <span class="card-subtitle">Desbloquea todos los logros</span>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;" id="achievementsGrid">
                        <div class="achievement-card locked" data-achievement="first-exercise">
                            <span class="achievement-icon">üéØ</span>
                            <span class="achievement-name">Primer Paso</span>
                            <span class="achievement-desc">Completa tu primer ejercicio</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="streak-5">
                            <span class="achievement-icon">üî•</span>
                            <span class="achievement-name">En Racha</span>
                            <span class="achievement-desc">5 respuestas correctas seguidas</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="level-3">
                            <span class="achievement-icon">üìà</span>
                            <span class="achievement-name">Estudiante Dedicado</span>
                            <span class="achievement-desc">Alcanza el nivel 3</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="perfect-quiz">
                            <span class="achievement-icon">üíØ</span>
                            <span class="achievement-name">Perfeccionista</span>
                            <span class="achievement-desc">Quiz perfecto (5/5)</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="control-master">
                            <span class="achievement-icon">üìâ</span>
                            <span class="achievement-name">Maestro del Control</span>
                            <span class="achievement-desc">10 ejercicios de gr√°ficos</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="capability-expert">
                            <span class="achievement-icon">üéØ</span>
                            <span class="achievement-name">Experto en Capacidad</span>
                            <span class="achievement-desc">10 ejercicios de Cp/Cpk</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="speed-demon">
                            <span class="achievement-icon">‚ö°</span>
                            <span class="achievement-name">Veloz</span>
                            <span class="achievement-desc">Completa un quiz en menos de 60s</span>
                        </div>
                        <div class="achievement-card locked" data-achievement="spc-expert">
                            <span class="achievement-icon">üëë</span>
                            <span class="achievement-name">Experto SPC</span>
                            <span class="achievement-desc">Alcanza 500 puntos</span>
                        </div>
                    </div>
                </div>

                <!-- Practice Modes -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üéÆ</span>
                        <div>
                            <h3 class="card-title">Modos de Pr√°ctica</h3>
                            <span class="card-subtitle">Elige c√≥mo quieres practicar</span>
                        </div>
                    </div>
                    <div class="chart-types-grid">
                        <div class="chart-type-card" onclick="startPracticeMode('quiz')">
                            <div class="chart-type-icon">üìù</div>
                            <div class="chart-type-name">Quiz R√°pido</div>
                            <div class="chart-type-desc">5 preguntas de opci√≥n m√∫ltiple. +10 puntos por respuesta correcta.</div>
                        </div>
                        <div class="chart-type-card" onclick="startPracticeMode('calculation')">
                            <div class="chart-type-icon">üî¢</div>
                            <div class="chart-type-name">C√°lculo Paso a Paso</div>
                            <div class="chart-type-desc">Resuelve problemas con gu√≠a interactiva. +20 puntos por ejercicio.</div>
                        </div>
                        <div class="chart-type-card" onclick="startPracticeMode('interpretation')">
                            <div class="chart-type-icon">üìä</div>
                            <div class="chart-type-name">Interpretaci√≥n</div>
                            <div class="chart-type-desc">Analiza gr√°ficos y datos reales. +15 puntos por an√°lisis correcto.</div>
                        </div>
                        <div class="chart-type-card" onclick="startPracticeMode('timed')">
                            <div class="chart-type-icon">‚è±Ô∏è</div>
                            <div class="chart-type-name">Desaf√≠o Cronometrado</div>
                            <div class="chart-type-desc">¬°60 segundos! Responde el m√°ximo posible. Bonificaci√≥n por tiempo.</div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Area (hidden by default) -->
                <div id="quizArea" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon" id="quizModeIcon">üìù</span>
                        <div>
                            <h3 class="card-title" id="quizModeTitle">Quiz R√°pido</h3>
                            <span class="card-subtitle" id="quizProgress">Pregunta 1 de 5</span>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 15px; align-items: center;">
                            <div id="quizTimer" style="font-size: 24px; font-weight: bold; color: var(--accent);" class="hidden">60</div>
                            <button class="btn btn-secondary" onclick="closeQuiz()">‚úï Cerrar</button>
                        </div>
                    </div>

                    <div id="quizQuestion" class="exercise-content" style="font-size: 16px; margin: 20px 0;"></div>

                    <div id="quizOptions" class="exercise-options"></div>

                    <div id="quizFeedback" class="exercise-feedback" style="display: none;"></div>

                    <div class="btn-group" style="margin-top: 20px;">
                        <button id="nextQuestionBtn" class="btn btn-primary hidden" onclick="nextQuestion()">Siguiente Pregunta ‚Üí</button>
                        <button id="finishQuizBtn" class="btn btn-accent hidden" onclick="finishQuiz()">Ver Resultados</button>
                    </div>
                </div>

                <!-- Quiz Results -->
                <div id="quizResults" class="card hidden">
                    <div style="text-align: center; padding: 30px;">
                        <div style="font-size: 80px; margin-bottom: 20px;" id="resultsEmoji">üéâ</div>
                        <h2 id="resultsTitle" style="margin-bottom: 15px;">¬°Quiz Completado!</h2>
                        <div style="display: flex; justify-content: center; gap: 30px; margin: 30px 0;">
                            <div>
                                <div style="font-size: 48px; font-weight: bold; color: var(--success);" id="resultsScore">5/5</div>
                                <div style="color: var(--text-secondary);">Respuestas Correctas</div>
                            </div>
                            <div>
                                <div style="font-size: 48px; font-weight: bold; color: var(--accent);" id="resultsPoints">+50</div>
                                <div style="color: var(--text-secondary);">Puntos Ganados</div>
                            </div>
                        </div>
                        <div id="newAchievements" style="margin: 20px 0;"></div>
                        <button class="btn btn-primary" onclick="closeResults()">Continuar Practicando</button>
                    </div>
                </div>

                <!-- Step Calculator -->
                <div id="stepCalculator" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üî¢</span>
                        <div>
                            <h3 class="card-title">Calculadora Paso a Paso</h3>
                            <span class="card-subtitle" id="calcTopic">Gr√°fico X-bar R</span>
                        </div>
                        <button class="btn btn-secondary" onclick="closeCalculator()" style="margin-left: auto;">‚úï Cerrar</button>
                    </div>

                    <div id="calcProblem" class="exercise-content" style="margin: 20px 0;"></div>

                    <div id="calcSteps" class="steps-container"></div>

                    <div class="controls-panel" id="calcInputArea"></div>

                    <div id="calcFeedback" class="info-box" style="display: none;"></div>

                    <div class="btn-group">
                        <button id="calcCheckBtn" class="btn btn-primary" onclick="checkCalculation()">Verificar Respuesta</button>
                        <button id="calcNextBtn" class="btn btn-accent hidden" onclick="nextCalcStep()">Siguiente Paso ‚Üí</button>
                        <button id="calcFinishBtn" class="btn btn-secondary hidden" onclick="finishCalculation()">Finalizar</button>
                    </div>
                </div>
            </div>

            <!-- Tab: Simulator -->
            <div id="simulator" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üß™</span>
                        <div>
                            <h3 class="card-title">Simulador de Datos SPC</h3>
                            <span class="card-subtitle">Analiza tus propios datos o genera datos de prueba</span>
                        </div>
                    </div>

                    <div class="two-columns">
                        <div>
                            <h4 class="section-title">Ingreso de Datos</h4>
                            <div class="control-group">
                                <label class="control-label">Tipo de an√°lisis:</label>
                                <select id="simAnalysisType" class="control-input" onchange="updateSimulatorUI()">
                                    <option value="xbar-r">Gr√°fico XÃÑ-R (Variables)</option>
                                    <option value="individual">Gr√°fico I-MR (Individual)</option>
                                    <option value="p-chart">Gr√°fico p (Atributos)</option>
                                    <option value="capability">An√°lisis de Capacidad</option>
                                </select>
                            </div>

                            <div id="simXbarRConfig">
                                <div class="control-group">
                                    <label class="control-label">Tama√±o de subgrupo (n):</label>
                                    <input type="number" id="simSubgroupSize" class="control-input" value="5" min="2" max="10">
                                </div>
                            </div>

                            <div id="simCapabilityConfig" class="hidden">
                                <div class="control-group">
                                    <label class="control-label">L√≠mite Inferior (LSL):</label>
                                    <input type="number" id="simLSL" class="control-input" value="45" step="0.1">
                                </div>
                                <div class="control-group">
                                    <label class="control-label">L√≠mite Superior (USL):</label>
                                    <input type="number" id="simUSL" class="control-input" value="55" step="0.1">
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">Datos (un valor por l√≠nea o separados por coma):</label>
                                <textarea id="simDataInput" class="control-input" rows="10" placeholder="Copia y pega tus datos aqu√≠...&#10;Ejemplo:&#10;50.2, 49.8, 50.1, 50.5, 49.9&#10;50.3, 50.0, 49.7, 50.2, 50.1&#10;..." style="resize: vertical; font-family: monospace;"></textarea>
                            </div>

                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="analyzeSimData()">üìä Analizar Datos</button>
                                <button class="btn btn-secondary" onclick="generateSimData()">üé≤ Generar Datos Aleatorios</button>
                                <button class="btn btn-accent" onclick="clearSimData()">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>

                        <div>
                            <h4 class="section-title">Generador de Datos de Prueba</h4>
                            <div class="info-box">
                                <strong>üí° Usa el generador para practicar:</strong>
                                <p style="margin-top: 10px;">Genera datos aleatorios con diferentes caracter√≠sticas para practicar el an√°lisis SPC.</p>
                            </div>

                            <div class="control-group" style="margin-top: 15px;">
                                <label class="control-label">Escenario de simulaci√≥n:</label>
                                <select id="simScenario" class="control-input">
                                    <option value="normal">Proceso estable (normal)</option>
                                    <option value="shift">Cambio de media (shift)</option>
                                    <option value="trend">Tendencia (drift)</option>
                                    <option value="high-var">Alta variabilidad</option>
                                    <option value="out-of-spec">Fuera de especificaci√≥n</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label class="control-label">Media objetivo:</label>
                                <input type="number" id="simTargetMean" class="control-input" value="50" step="0.1">
                            </div>

                            <div class="control-group">
                                <label class="control-label">Desviaci√≥n est√°ndar:</label>
                                <input type="number" id="simTargetSigma" class="control-input" value="1.5" step="0.1">
                            </div>

                            <div class="control-group">
                                <label class="control-label">N√∫mero de subgrupos/muestras:</label>
                                <input type="number" id="simNumSamples" class="control-input" value="25" min="10" max="50">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="simResultsSection" class="card hidden">
                    <div class="card-header">
                        <span class="card-icon">üìà</span>
                        <div>
                            <h3 class="card-title">Resultados del An√°lisis</h3>
                            <span class="card-subtitle" id="simResultsSubtitle">Gr√°fico XÃÑ-R</span>
                        </div>
                    </div>

                    <!-- Statistics Summary -->
                    <div class="stats-bar" id="simStatsBar">
                        <div class="stat-item">
                            <span class="stat-icon">üìä</span>
                            <div>
                                <div class="stat-value" id="simStatMean">--</div>
                                <div class="stat-label">Media</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">üìè</span>
                            <div>
                                <div class="stat-value" id="simStatSigma">--</div>
                                <div class="stat-label">Desv. Est.</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚¨ÜÔ∏è</span>
                            <div>
                                <div class="stat-value" id="simStatUCL">--</div>
                                <div class="stat-label">UCL</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚¨áÔ∏è</span>
                            <div>
                                <div class="stat-value" id="simStatLCL">--</div>
                                <div class="stat-label">LCL</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">‚ö†Ô∏è</span>
                            <div>
                                <div class="stat-value" id="simStatOOC">--</div>
                                <div class="stat-label">Fuera de Control</div>
                            </div>
                        </div>
                    </div>

                    <!-- Capability Results (shown when applicable) -->
                    <div id="simCapabilityResults" class="hidden">
                        <h4 class="section-title">√çndices de Capacidad</h4>
                        <div class="capability-grid">
                            <div class="capability-indicator">
                                <div class="capability-value" id="simCp">--</div>
                                <div class="capability-label">Cp</div>
                            </div>
                            <div class="capability-indicator">
                                <div class="capability-value" id="simCpk">--</div>
                                <div class="capability-label">Cpk</div>
                            </div>
                            <div class="capability-indicator">
                                <div class="capability-value" id="simCpu">--</div>
                                <div class="capability-label">Cpu</div>
                            </div>
                            <div class="capability-indicator">
                                <div class="capability-value" id="simCpl">--</div>
                                <div class="capability-label">Cpl</div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="two-columns" id="simChartsContainer">
                        <div class="chart-container">
                            <h4 style="text-align: center; margin-bottom: 15px;" id="simChart1Title">Gr√°fico XÃÑ</h4>
                            <div class="chart-wrapper">
                                <canvas id="simChart1"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 style="text-align: center; margin-bottom: 15px;" id="simChart2Title">Gr√°fico R</h4>
                            <div class="chart-wrapper">
                                <canvas id="simChart2"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Interpretation -->
                    <div class="info-box" id="simInterpretation">
                        <strong>üìã Interpretaci√≥n:</strong>
                        <div id="simInterpretationContent"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Password constant
        const APP_PASSWORD = '2026';

        // Chart instances
        let xbarChartInstance = null;
        let rChartInstance = null;
        let pChartInstance = null;

        // Control chart constants
        const CONSTANTS = {
            2: { A2: 1.880, D3: 0, D4: 3.267, d2: 1.128 },
            3: { A2: 1.023, D3: 0, D4: 2.574, d2: 1.693 },
            4: { A2: 0.729, D3: 0, D4: 2.282, d2: 2.059 },
            5: { A2: 0.577, D3: 0, D4: 2.114, d2: 2.326 },
            6: { A2: 0.483, D3: 0, D4: 2.004, d2: 2.534 },
            7: { A2: 0.419, D3: 0.076, D4: 1.924, d2: 2.704 },
            8: { A2: 0.373, D3: 0.136, D4: 1.864, d2: 2.847 },
            9: { A2: 0.337, D3: 0.184, D4: 1.816, d2: 2.970 },
            10: { A2: 0.308, D3: 0.223, D4: 1.777, d2: 3.078 }
        };

        // Exercise answers
        const EXERCISE_ANSWERS = {
            1: { correct: 'a', explanation: 'UCL = XÃø + A‚ÇÇRÃÑ = 25.3 + (0.577 √ó 4.2) = 25.3 + 2.42 = 27.72 mm' },
            2: { correct: 'c', explanation: 'Un punto fuera de control en el gr√°fico R indica que la variabilidad dentro de ese subgrupo fue inusualmente alta, lo que puede deberse a una causa especial como cambio de operador, material defectuoso, o ajuste incorrecto de m√°quina.' },
            3: { correct: 'b', explanation: 'pÃÑ = Total defectuosos / Total inspeccionados = 45 / (200 √ó 10) = 45 / 2000 = 0.0225' },
            4: { correct: 'a', explanation: 'Cp = (USL - LSL) / 6œÉ = (505 - 495) / (6 √ó 1.2) = 10 / 7.2 = 1.39' },
            5: { correct: 'b', explanation: 'Cuando Cp > Cpk, significa que el proceso tiene variabilidad aceptable (potencial) pero no est√° centrado. La diferencia (1.50 - 0.75 = 0.75) indica un descentrado significativo. La acci√≥n correctiva es centrar el proceso.' },
            6: { correct: 'b', explanation: 'Cpu = (USL - Œº) / 3œÉ = (105 - 102) / (3 √ó 1.5) = 3 / 4.5 = 0.67<br>Cpl = (Œº - LSL) / 3œÉ = (102 - 95) / (3 √ó 1.5) = 7 / 4.5 = 1.56<br>Cpk = min(Cpu, Cpl) = min(0.67, 1.56) = 0.67' },
            7: { correct: 'a', explanation: 'Total = 120 + 85 + 45 + 30 + 20 = 300<br>Fugas + Deformaci√≥n = 120 + 85 = 205<br>Porcentaje = 205/300 √ó 100 = 68.3%<br>Las dos primeras categor√≠as representan el 68.3% de los defectos, cumpliendo aproximadamente el principio de Pareto.' },
            8: { correct: 'b', explanation: 'Aunque la causa menciona "procedimiento", el problema ra√≠z es que el OPERADOR (factor humano) no lo est√° siguiendo. La categor√≠a "Mano de obra" incluye comportamientos, habilidades, motivaci√≥n y adherencia a procedimientos por parte del personal.' },
            9: { correct: 'c', explanation: 'Un coeficiente r = -0.85 indica una correlaci√≥n negativa fuerte. Esto significa que a medida que aumentan las horas de capacitaci√≥n, disminuye el n√∫mero de errores. El signo negativo indica relaci√≥n inversa y el valor cercano a -1 indica que la relaci√≥n es fuerte.' }
        };

        // Data storage
        let xbarRData = {
            means: [],
            ranges: [],
            xDoublebar: 0,
            rBar: 0,
            uclX: 0,
            lclX: 0,
            uclR: 0,
            lclR: 0
        };

        // Password verification
        function verifyPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === APP_PASSWORD) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                initializeApp();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
            }
        }

        // Enter key for password
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyPassword();
            }
        });

        // Initialize application
        function initializeApp() {
            // Update trial badge
            if (window._trialDaysLeft !== undefined) {
                document.getElementById('trialDays').textContent = `${window._trialDaysLeft} d√≠as restantes`;
            } else {
                document.getElementById('trialDays').textContent = '10 d√≠as restantes';
            }

            // Initialize capability chart
            updateCapabilityChart();
        }

        // Tab navigation
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(navTab => {
                navTab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
        }

        // Show chart detail section
        function showChartDetail(chartType) {
            const detailId = chartType + '-detail';
            const detailElement = document.getElementById(detailId);
            if (detailElement) {
                detailElement.classList.remove('hidden');
                detailElement.scrollIntoView({ behavior: 'smooth' });

                // Generate initial data for interactive charts
                if (chartType === 'xbar-r') {
                    setTimeout(() => generateXbarRData(), 300);
                } else if (chartType === 'p') {
                    setTimeout(() => generatePChartData(), 300);
                }
            }
        }

        function hideChartDetail(chartType) {
            const detailId = chartType + '-detail';
            document.getElementById(detailId).classList.add('hidden');
        }

        // Generate random normal data
        function randomNormal(mean, stdDev) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return mean + stdDev * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        // Generate X-bar R chart data
        function generateXbarRData() {
            const n = parseInt(document.getElementById('xbarRSubgroupSize').value);
            const mean = parseFloat(document.getElementById('xbarRMean').value);
            const sigma = parseFloat(document.getElementById('xbarRSigma').value);
            const k = parseInt(document.getElementById('xbarRSubgroups').value);

            const constants = CONSTANTS[n];
            xbarRData.means = [];
            xbarRData.ranges = [];

            // Generate subgroup data
            for (let i = 0; i < k; i++) {
                let subgroup = [];
                for (let j = 0; j < n; j++) {
                    subgroup.push(randomNormal(mean, sigma));
                }
                const subgroupMean = subgroup.reduce((a, b) => a + b, 0) / n;
                const subgroupRange = Math.max(...subgroup) - Math.min(...subgroup);

                xbarRData.means.push(subgroupMean);
                xbarRData.ranges.push(subgroupRange);
            }

            // Calculate control limits
            xbarRData.xDoublebar = xbarRData.means.reduce((a, b) => a + b, 0) / k;
            xbarRData.rBar = xbarRData.ranges.reduce((a, b) => a + b, 0) / k;

            xbarRData.uclX = xbarRData.xDoublebar + constants.A2 * xbarRData.rBar;
            xbarRData.lclX = xbarRData.xDoublebar - constants.A2 * xbarRData.rBar;
            xbarRData.uclR = constants.D4 * xbarRData.rBar;
            xbarRData.lclR = constants.D3 * xbarRData.rBar;

            updateXbarRChart();
        }

        // Add out of control point
        function addOutOfControl() {
            if (xbarRData.means.length === 0) {
                generateXbarRData();
                return;
            }

            const randomIndex = Math.floor(Math.random() * xbarRData.means.length);
            const shift = (Math.random() > 0.5 ? 1 : -1) * (xbarRData.uclX - xbarRData.xDoublebar) * 1.3;
            xbarRData.means[randomIndex] = xbarRData.xDoublebar + shift;

            updateXbarRChart();
        }

        // Update X-bar R charts
        function updateXbarRChart() {
            if (xbarRData.means.length === 0) return;

            const labels = xbarRData.means.map((_, i) => `${i + 1}`);

            // Destroy existing charts
            if (xbarChartInstance) xbarChartInstance.destroy();
            if (rChartInstance) rChartInstance.destroy();

            // X-bar chart
            const xbarCtx = document.getElementById('xbarChart').getContext('2d');
            xbarChartInstance = new Chart(xbarCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'XÃÑ',
                            data: xbarRData.means,
                            borderColor: '#42a5f5',
                            backgroundColor: 'rgba(66, 165, 245, 0.1)',
                            pointBackgroundColor: xbarRData.means.map(v =>
                                v > xbarRData.uclX || v < xbarRData.lclX ? '#ff6b6b' : '#42a5f5'
                            ),
                            pointRadius: 5,
                            tension: 0.1
                        },
                        {
                            label: 'UCL',
                            data: Array(labels.length).fill(xbarRData.uclX),
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'CL',
                            data: Array(labels.length).fill(xbarRData.xDoublebar),
                            borderColor: '#4caf50',
                            borderDash: [10, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'LCL',
                            data: Array(labels.length).fill(xbarRData.lclX),
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Subgrupo', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Media', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // R chart
            const rCtx = document.getElementById('rChart').getContext('2d');
            rChartInstance = new Chart(rCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'R',
                            data: xbarRData.ranges,
                            borderColor: '#ff9800',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            pointBackgroundColor: xbarRData.ranges.map(v =>
                                v > xbarRData.uclR || v < xbarRData.lclR ? '#ff6b6b' : '#ff9800'
                            ),
                            pointRadius: 5,
                            tension: 0.1
                        },
                        {
                            label: 'UCL',
                            data: Array(labels.length).fill(xbarRData.uclR),
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'CL',
                            data: Array(labels.length).fill(xbarRData.rBar),
                            borderColor: '#4caf50',
                            borderDash: [10, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'LCL',
                            data: Array(labels.length).fill(xbarRData.lclR),
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Subgrupo', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Rango', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // Update results
            const outOfControlX = xbarRData.means.filter(v => v > xbarRData.uclX || v < xbarRData.lclX).length;
            const outOfControlR = xbarRData.ranges.filter(v => v > xbarRData.uclR || v < xbarRData.lclR).length;

            document.getElementById('xbarRResults').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>XÃø (Gran Media):</strong> ${xbarRData.xDoublebar.toFixed(3)}</div>
                    <div><strong>RÃÑ (Rango Promedio):</strong> ${xbarRData.rBar.toFixed(3)}</div>
                    <div><strong>UCL (XÃÑ):</strong> ${xbarRData.uclX.toFixed(3)}</div>
                    <div><strong>LCL (XÃÑ):</strong> ${xbarRData.lclX.toFixed(3)}</div>
                    <div><strong>UCL (R):</strong> ${xbarRData.uclR.toFixed(3)}</div>
                    <div><strong>LCL (R):</strong> ${xbarRData.lclR.toFixed(3)}</div>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Puntos fuera de control:</strong>
                    <span style="color: ${outOfControlX > 0 ? '#ff6b6b' : '#4caf50'}">Gr√°fico XÃÑ: ${outOfControlX}</span> |
                    <span style="color: ${outOfControlR > 0 ? '#ff6b6b' : '#4caf50'}">Gr√°fico R: ${outOfControlR}</span>
                </div>
            `;
        }

        // Generate p Chart data
        function generatePChartData() {
            const pBar = parseFloat(document.getElementById('pChartProportion').value);
            const avgSampleSize = parseInt(document.getElementById('pChartSampleSize').value);
            const numSamples = parseInt(document.getElementById('pChartSamples').value);

            const proportions = [];
            const sampleSizes = [];
            const ucl = [];
            const lcl = [];
            let totalDefects = 0;
            let totalSamples = 0;

            for (let i = 0; i < numSamples; i++) {
                // Variable sample size (¬±20%)
                const n = Math.round(avgSampleSize * (0.8 + Math.random() * 0.4));
                sampleSizes.push(n);

                // Generate defects using binomial-like distribution
                let defects = 0;
                for (let j = 0; j < n; j++) {
                    if (Math.random() < pBar) defects++;
                }

                // Occasionally add special cause
                if (Math.random() < 0.1) {
                    defects += Math.floor(n * pBar * (0.5 + Math.random()));
                }

                proportions.push(defects / n);
                totalDefects += defects;
                totalSamples += n;

                // Calculate limits for this sample
                const stdError = Math.sqrt(pBar * (1 - pBar) / n);
                ucl.push(pBar + 3 * stdError);
                lcl.push(Math.max(0, pBar - 3 * stdError));
            }

            if (pChartInstance) pChartInstance.destroy();

            const labels = proportions.map((_, i) => `${i + 1}`);
            const pChartCtx = document.getElementById('pChart').getContext('2d');

            pChartInstance = new Chart(pChartCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'p (Proporci√≥n)',
                            data: proportions,
                            borderColor: '#9c27b0',
                            backgroundColor: 'rgba(156, 39, 176, 0.1)',
                            pointBackgroundColor: proportions.map((v, i) =>
                                v > ucl[i] || v < lcl[i] ? '#ff6b6b' : '#9c27b0'
                            ),
                            pointRadius: 5,
                            tension: 0.1
                        },
                        {
                            label: 'UCL',
                            data: ucl,
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'pÃÑ',
                            data: Array(numSamples).fill(pBar),
                            borderColor: '#4caf50',
                            borderDash: [10, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'LCL',
                            data: lcl,
                            borderColor: '#ff6b6b',
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Muestra', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Proporci√≥n Defectuosos', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            min: 0
                        }
                    }
                }
            });

            const outOfControl = proportions.filter((v, i) => v > ucl[i] || v < lcl[i]).length;
            document.getElementById('pChartResults').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>pÃÑ (Proporci√≥n media):</strong> ${(totalDefects/totalSamples).toFixed(4)}</div>
                    <div><strong>Total defectuosos:</strong> ${totalDefects}</div>
                    <div><strong>Total inspeccionados:</strong> ${totalSamples}</div>
                    <div><strong>Puntos fuera de control:</strong> <span style="color: ${outOfControl > 0 ? '#ff6b6b' : '#4caf50'}">${outOfControl}</span></div>
                </div>
            `;
        }

        // Update capability chart
        function updateCapabilityChart() {
            const lsl = parseFloat(document.getElementById('capLSL').value);
            const usl = parseFloat(document.getElementById('capUSL').value);
            const mean = parseFloat(document.getElementById('capMean').value);
            const sigma = parseFloat(document.getElementById('capSigma').value);

            // Generate distribution curve
            const x = [];
            const y = [];
            const range = 4 * sigma;

            for (let i = mean - range; i <= mean + range; i += range/100) {
                x.push(i);
                const z = (i - mean) / sigma;
                y.push(Math.exp(-0.5 * z * z) / (sigma * Math.sqrt(2 * Math.PI)));
            }

            const maxY = Math.max(...y);

            // Create Plotly chart
            const trace1 = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                fill: 'tozeroy',
                fillcolor: 'rgba(66, 165, 245, 0.3)',
                line: { color: '#42a5f5', width: 2 },
                name: 'Distribuci√≥n del Proceso'
            };

            const layout = {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#fff' },
                showlegend: false,
                margin: { l: 50, r: 50, t: 30, b: 50 },
                xaxis: {
                    title: 'Valor',
                    gridcolor: 'rgba(255,255,255,0.1)',
                    zerolinecolor: 'rgba(255,255,255,0.2)'
                },
                yaxis: {
                    title: 'Densidad',
                    gridcolor: 'rgba(255,255,255,0.1)',
                    zerolinecolor: 'rgba(255,255,255,0.2)'
                },
                shapes: [
                    {
                        type: 'line',
                        x0: lsl, x1: lsl,
                        y0: 0, y1: maxY * 1.1,
                        line: { color: '#ff6b6b', width: 3, dash: 'dash' }
                    },
                    {
                        type: 'line',
                        x0: usl, x1: usl,
                        y0: 0, y1: maxY * 1.1,
                        line: { color: '#ff6b6b', width: 3, dash: 'dash' }
                    },
                    {
                        type: 'line',
                        x0: mean, x1: mean,
                        y0: 0, y1: maxY,
                        line: { color: '#4caf50', width: 2 }
                    }
                ],
                annotations: [
                    {
                        x: lsl, y: maxY * 1.05,
                        text: 'LSL',
                        showarrow: false,
                        font: { color: '#ff6b6b', size: 14 }
                    },
                    {
                        x: usl, y: maxY * 1.05,
                        text: 'USL',
                        showarrow: false,
                        font: { color: '#ff6b6b', size: 14 }
                    },
                    {
                        x: mean, y: maxY * 0.95,
                        text: 'Œº',
                        showarrow: false,
                        font: { color: '#4caf50', size: 16 }
                    }
                ]
            };

            Plotly.newPlot('capabilityComparison', [trace1], layout, { responsive: true });

            // Calculate capability indices
            const cp = (usl - lsl) / (6 * sigma);
            const cpu = (usl - mean) / (3 * sigma);
            const cpl = (mean - lsl) / (3 * sigma);
            const cpk = Math.min(cpu, cpl);

            // Update display
            updateCapabilityIndicator('cpValue', cp);
            updateCapabilityIndicator('cpkValue', cpk);
            document.getElementById('cpuValue').textContent = cpu.toFixed(2);
            document.getElementById('cplValue').textContent = cpl.toFixed(2);
        }

        function updateCapabilityIndicator(elementId, value) {
            const element = document.getElementById(elementId);
            element.textContent = value.toFixed(2);
            element.className = 'capability-value';

            if (value >= 1.33) {
                element.classList.add('good');
            } else if (value >= 1.00) {
                element.classList.add('marginal');
            } else {
                element.classList.add('poor');
            }
        }

        function updateFromSlider() {
            const value = document.getElementById('meanSlider').value;
            document.getElementById('capMean').value = value;
            document.getElementById('sliderMeanValue').textContent = value;
            updateCapabilityChart();
        }

        // Exercise checking
        function checkExercise(exerciseNum, answer, element) {
            const exerciseData = EXERCISE_ANSWERS[exerciseNum];
            const feedbackElement = document.getElementById(`exercise${exerciseNum}Feedback`);
            const optionsContainer = document.getElementById(`exercise${exerciseNum}Options`);

            // Remove previous selections
            optionsContainer.querySelectorAll('.exercise-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            if (answer === exerciseData.correct) {
                element.classList.add('correct');
                feedbackElement.className = 'exercise-feedback correct';
                feedbackElement.innerHTML = `<strong>‚úÖ ¬°Correcto!</strong><br>${exerciseData.explanation}`;
            } else {
                element.classList.add('incorrect');
                // Show correct answer
                const correctOption = optionsContainer.querySelector(`.exercise-option:nth-child(${exerciseData.correct.charCodeAt(0) - 96})`);
                correctOption.classList.add('correct');
                feedbackElement.className = 'exercise-feedback incorrect';
                feedbackElement.innerHTML = `<strong>‚ùå Incorrecto</strong><br>${exerciseData.explanation}`;
            }
        }

        // ============================================
        // QUALITY TOOLS FUNCTIONS
        // ============================================

        let paretoChartInstance = null;
        let histogramChartInstance = null;
        let scatterChartInstance = null;

        // Show/Hide tool details
        function showToolDetail(toolType) {
            const detailId = toolType + '-detail';
            const detailElement = document.getElementById(detailId);
            if (detailElement) {
                detailElement.classList.remove('hidden');
                detailElement.scrollIntoView({ behavior: 'smooth' });

                // Initialize charts when shown
                if (toolType === 'histogram') {
                    setTimeout(() => generateHistogramData(), 300);
                } else if (toolType === 'scatter') {
                    setTimeout(() => generateScatterData(), 300);
                }
            }
        }

        function hideToolDetail(toolType) {
            const detailId = toolType + '-detail';
            document.getElementById(detailId).classList.add('hidden');
        }

        // ============================================
        // PARETO CHART
        // ============================================

        function loadParetoExample() {
            const example = document.getElementById('paretoExample').value;
            const textarea = document.getElementById('paretoData');

            const examples = {
                defectos: `Rayones:45
Burbujas:32
Manchas:28
Grietas:15
Deformaciones:10
Otros:8`,
                quejas: `Tiempo de espera:85
Producto defectuoso:62
Mala atenci√≥n:45
Precio incorrecto:25
Empaque da√±ado:18
Otros:12`,
                paradas: `Falla mec√°nica:120
Cambio de producto:85
Falta de material:55
Mantenimiento:40
Falla el√©ctrica:30
Otros:15`
            };

            if (examples[example]) {
                textarea.value = examples[example];
                generateParetoChart();
            }
        }

        function generateParetoChart() {
            const dataText = document.getElementById('paretoData').value.trim();
            if (!dataText) {
                alert('Ingrese datos en el formato Categor√≠a:Valor');
                return;
            }

            const lines = dataText.split('\n');
            const data = [];

            for (const line of lines) {
                const parts = line.split(':');
                if (parts.length === 2) {
                    const category = parts[0].trim();
                    const value = parseFloat(parts[1].trim());
                    if (!isNaN(value)) {
                        data.push({ category, value });
                    }
                }
            }

            if (data.length === 0) {
                alert('No se encontraron datos v√°lidos');
                return;
            }

            // Sort by value descending
            data.sort((a, b) => b.value - a.value);

            // Calculate percentages and cumulative
            const total = data.reduce((sum, d) => sum + d.value, 0);
            let cumulative = 0;
            const percentages = [];
            const cumulativePercentages = [];

            for (const d of data) {
                const pct = (d.value / total) * 100;
                cumulative += pct;
                percentages.push(pct);
                cumulativePercentages.push(cumulative);
            }

            // Create chart
            if (paretoChartInstance) paretoChartInstance.destroy();

            const ctx = document.getElementById('paretoChart').getContext('2d');
            paretoChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.category),
                    datasets: [
                        {
                            label: 'Frecuencia',
                            data: data.map(d => d.value),
                            backgroundColor: data.map((_, i) =>
                                i < Math.ceil(data.length * 0.2) ? 'rgba(198, 40, 40, 0.8)' : 'rgba(66, 165, 245, 0.8)'
                            ),
                            borderColor: data.map((_, i) =>
                                i < Math.ceil(data.length * 0.2) ? '#c62828' : '#42a5f5'
                            ),
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: '% Acumulado',
                            data: cumulativePercentages,
                            type: 'line',
                            borderColor: '#ff9800',
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointBackgroundColor: '#ff9800',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#fff' } }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'Frecuencia', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: '% Acumulado', color: '#b2bac2' },
                            ticks: { color: '#ff9800' },
                            grid: { display: false },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // Show analysis
            const vital = data.slice(0, Math.ceil(data.length * 0.2));
            const vitalSum = vital.reduce((sum, d) => sum + d.value, 0);
            const vitalPct = (vitalSum / total * 100).toFixed(1);

            document.getElementById('paretoAnalysis').style.display = 'block';
            document.getElementById('paretoAnalysisContent').innerHTML = `
                <p style="margin-top: 10px;">
                    <strong>Total de observaciones:</strong> ${total}<br>
                    <strong>Categor√≠as "Pocos Vitales" (${vital.length}):</strong> ${vital.map(d => d.category).join(', ')}<br>
                    <strong>Representan el ${vitalPct}% del total</strong><br>
                    <em>Recomendaci√≥n: Enfocar esfuerzos de mejora en las categor√≠as resaltadas en rojo.</em>
                </p>
            `;
        }

        // ============================================
        // ISHIKAWA DIAGRAM
        // ============================================

        function generateIshikawa() {
            const effect = document.getElementById('ishikawaEffect').value || 'Problema';
            const categories = {
                'Mano de obra': document.getElementById('ishikawaMano').value.split('\n').filter(c => c.trim()),
                'M√°quina': document.getElementById('ishikawaMaquina').value.split('\n').filter(c => c.trim()),
                'Material': document.getElementById('ishikawaMaterial').value.split('\n').filter(c => c.trim()),
                'M√©todo': document.getElementById('ishikawaMetodo').value.split('\n').filter(c => c.trim()),
                'Medici√≥n': document.getElementById('ishikawaMedicion').value.split('\n').filter(c => c.trim()),
                'Medio ambiente': document.getElementById('ishikawaMedio').value.split('\n').filter(c => c.trim())
            };

            const container = document.getElementById('ishikawaChart');
            const width = container.offsetWidth;
            const height = 500;

            // Create SVG
            let svg = `<svg width="${width}" height="${height}" style="font-family: 'Segoe UI', sans-serif;">`;

            // Main spine (horizontal line)
            const spineY = height / 2;
            const spineStart = 50;
            const spineEnd = width - 150;

            svg += `<line x1="${spineStart}" y1="${spineY}" x2="${spineEnd}" y2="${spineY}" stroke="#42a5f5" stroke-width="4"/>`;

            // Effect box (fish head)
            svg += `
                <rect x="${spineEnd}" y="${spineY - 40}" width="130" height="80" rx="10" fill="#c62828" stroke="#ff6b6b" stroke-width="2"/>
                <text x="${spineEnd + 65}" y="${spineY + 5}" text-anchor="middle" fill="white" font-size="12" font-weight="bold">
                    ${effect.length > 20 ? effect.substring(0, 17) + '...' : effect}
                </text>
            `;

            // Categories (bones)
            const catNames = Object.keys(categories);
            const topCats = catNames.slice(0, 3);
            const bottomCats = catNames.slice(3, 6);

            const colors = ['#4caf50', '#ff9800', '#9c27b0', '#00bcd4', '#e91e63', '#cddc39'];
            const spacing = (spineEnd - spineStart - 100) / 3;

            // Draw top bones
            topCats.forEach((cat, i) => {
                const x = spineStart + 80 + (i * spacing);
                const causes = categories[cat];
                const color = colors[i];

                // Main bone
                svg += `<line x1="${x}" y1="${spineY}" x2="${x + 60}" y2="${spineY - 120}" stroke="${color}" stroke-width="3"/>`;

                // Category label
                svg += `
                    <rect x="${x + 30}" y="${spineY - 150}" width="100" height="25" rx="5" fill="${color}"/>
                    <text x="${x + 80}" y="${spineY - 132}" text-anchor="middle" fill="white" font-size="11" font-weight="bold">${cat}</text>
                `;

                // Sub-causes
                causes.forEach((cause, j) => {
                    const subY = spineY - 30 - (j * 25);
                    const subX = x + (j % 2 === 0 ? 15 : 35);
                    svg += `<line x1="${x + 20 + j * 5}" y1="${subY}" x2="${subX + 70}" y2="${subY - 15}" stroke="${color}" stroke-width="1.5"/>`;
                    svg += `<text x="${subX + 75}" y="${subY - 10}" fill="#b2bac2" font-size="10">${cause.trim().substring(0, 20)}</text>`;
                });
            });

            // Draw bottom bones
            bottomCats.forEach((cat, i) => {
                const x = spineStart + 80 + (i * spacing);
                const causes = categories[cat];
                const color = colors[i + 3];

                // Main bone
                svg += `<line x1="${x}" y1="${spineY}" x2="${x + 60}" y2="${spineY + 120}" stroke="${color}" stroke-width="3"/>`;

                // Category label
                svg += `
                    <rect x="${x + 30}" y="${spineY + 130}" width="100" height="25" rx="5" fill="${color}"/>
                    <text x="${x + 80}" y="${spineY + 147}" text-anchor="middle" fill="white" font-size="11" font-weight="bold">${cat}</text>
                `;

                // Sub-causes
                causes.forEach((cause, j) => {
                    const subY = spineY + 30 + (j * 25);
                    const subX = x + (j % 2 === 0 ? 15 : 35);
                    svg += `<line x1="${x + 20 + j * 5}" y1="${subY}" x2="${subX + 70}" y2="${subY + 15}" stroke="${color}" stroke-width="1.5"/>`;
                    svg += `<text x="${subX + 75}" y="${subY + 20}" fill="#b2bac2" font-size="10">${cause.trim().substring(0, 20)}</text>`;
                });
            });

            svg += '</svg>';
            container.innerHTML = svg;
        }

        function clearIshikawa() {
            document.getElementById('ishikawaEffect').value = '';
            document.getElementById('ishikawaMano').value = '';
            document.getElementById('ishikawaMaquina').value = '';
            document.getElementById('ishikawaMaterial').value = '';
            document.getElementById('ishikawaMetodo').value = '';
            document.getElementById('ishikawaMedicion').value = '';
            document.getElementById('ishikawaMedio').value = '';
            document.getElementById('ishikawaChart').innerHTML = '<p style="text-align:center;color:#b2bac2;padding-top:200px;">Ingresa las causas y genera el diagrama</p>';
        }

        // ============================================
        // HISTOGRAM
        // ============================================

        function generateHistogramData() {
            const type = document.getElementById('histogramType').value;
            const n = parseInt(document.getElementById('histogramN').value);
            const bins = parseInt(document.getElementById('histogramBins').value);

            let data = [];
            const mean = 50;
            const std = 10;

            switch (type) {
                case 'normal':
                    for (let i = 0; i < n; i++) {
                        data.push(randomNormal(mean, std));
                    }
                    break;
                case 'skewed-right':
                    for (let i = 0; i < n; i++) {
                        // Log-normal approximation
                        const val = Math.exp(randomNormal(3.9, 0.3));
                        data.push(val);
                    }
                    break;
                case 'skewed-left':
                    for (let i = 0; i < n; i++) {
                        const val = 100 - Math.exp(randomNormal(3.9, 0.3));
                        data.push(val);
                    }
                    break;
                case 'bimodal':
                    for (let i = 0; i < n; i++) {
                        if (Math.random() < 0.5) {
                            data.push(randomNormal(35, 5));
                        } else {
                            data.push(randomNormal(65, 5));
                        }
                    }
                    break;
                case 'uniform':
                    for (let i = 0; i < n; i++) {
                        data.push(20 + Math.random() * 60);
                    }
                    break;
            }

            // Calculate histogram bins
            const minVal = Math.min(...data);
            const maxVal = Math.max(...data);
            const binWidth = (maxVal - minVal) / bins;

            const histogram = new Array(bins).fill(0);
            const binLabels = [];

            for (let i = 0; i < bins; i++) {
                const binStart = minVal + i * binWidth;
                const binEnd = binStart + binWidth;
                binLabels.push(`${binStart.toFixed(1)}`);

                for (const val of data) {
                    if (val >= binStart && (i === bins - 1 ? val <= binEnd : val < binEnd)) {
                        histogram[i]++;
                    }
                }
            }

            // Create chart
            if (histogramChartInstance) histogramChartInstance.destroy();

            const ctx = document.getElementById('histogramChart').getContext('2d');
            histogramChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frecuencia',
                        data: histogram,
                        backgroundColor: 'rgba(0, 137, 123, 0.7)',
                        borderColor: '#00897b',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Valor', color: '#b2bac2' },
                            ticks: { color: '#b2bac2', maxRotation: 45 },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Frecuencia', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // Update stats
            const dataMean = data.reduce((a, b) => a + b, 0) / n;
            const dataStd = Math.sqrt(data.reduce((sum, val) => sum + Math.pow(val - dataMean, 2), 0) / n);

            document.getElementById('histMean').textContent = dataMean.toFixed(2);
            document.getElementById('histStd').textContent = dataStd.toFixed(2);
            document.getElementById('histMin').textContent = minVal.toFixed(2);
            document.getElementById('histMax').textContent = maxVal.toFixed(2);
        }

        // ============================================
        // SCATTER DIAGRAM
        // ============================================

        function loadScatterExample() {
            const example = document.getElementById('scatterExample').value;
            if (example === 'temp-defects') {
                document.getElementById('scatterType').value = 'positive-strong';
            } else if (example === 'speed-quality') {
                document.getElementById('scatterType').value = 'negative-weak';
            } else if (example === 'training-errors') {
                document.getElementById('scatterType').value = 'negative-strong';
            }
            generateScatterData();
        }

        function generateScatterData() {
            const type = document.getElementById('scatterType').value;
            const n = parseInt(document.getElementById('scatterN').value);

            let xData = [];
            let yData = [];

            // Generate base X data
            for (let i = 0; i < n; i++) {
                xData.push(randomNormal(50, 15));
            }

            // Generate Y based on correlation type
            const correlations = {
                'positive-strong': 0.9,
                'positive-weak': 0.5,
                'none': 0,
                'negative-weak': -0.5,
                'negative-strong': -0.9
            };

            const targetR = correlations[type];

            for (let i = 0; i < n; i++) {
                const noise = randomNormal(0, 15 * Math.sqrt(1 - targetR * targetR));
                yData.push(50 + targetR * (xData[i] - 50) + noise);
            }

            // Create chart
            if (scatterChartInstance) scatterChartInstance.destroy();

            const scatterData = xData.map((x, i) => ({ x, y: yData[i] }));

            const ctx = document.getElementById('scatterChart').getContext('2d');
            scatterChartInstance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Datos',
                        data: scatterData,
                        backgroundColor: 'rgba(156, 39, 176, 0.7)',
                        borderColor: '#9c27b0',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Variable X', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Variable Y', color: '#b2bac2' },
                            ticks: { color: '#b2bac2' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // Calculate actual correlation
            const xMean = xData.reduce((a, b) => a + b, 0) / n;
            const yMean = yData.reduce((a, b) => a + b, 0) / n;

            let numerator = 0;
            let denomX = 0;
            let denomY = 0;

            for (let i = 0; i < n; i++) {
                numerator += (xData[i] - xMean) * (yData[i] - yMean);
                denomX += Math.pow(xData[i] - xMean, 2);
                denomY += Math.pow(yData[i] - yMean, 2);
            }

            const r = numerator / Math.sqrt(denomX * denomY);
            const r2 = r * r;

            // Update stats
            document.getElementById('correlationR').textContent = r.toFixed(3);
            document.getElementById('correlationR2').textContent = (r2 * 100).toFixed(1) + '%';

            let interpretation = '';
            const absR = Math.abs(r);
            if (absR >= 0.8) interpretation = r > 0 ? 'Positiva Fuerte' : 'Negativa Fuerte';
            else if (absR >= 0.5) interpretation = r > 0 ? 'Positiva Moderada' : 'Negativa Moderada';
            else if (absR >= 0.3) interpretation = r > 0 ? 'Positiva D√©bil' : 'Negativa D√©bil';
            else interpretation = 'Sin correlaci√≥n';

            document.getElementById('correlationInterpret').textContent = interpretation;
        }

        // ============================================
        // GAMIFICATION SYSTEM
        // ============================================

        // Player data
        let playerData = {
            points: 0,
            level: 1,
            xp: 0,
            streak: 0,
            completed: 0,
            achievements: [],
            controlExercises: 0,
            capabilityExercises: 0
        };

        // Quiz state
        let quizState = {
            mode: 'quiz',
            questions: [],
            currentIndex: 0,
            correct: 0,
            totalPoints: 0,
            timerInterval: null,
            timeLeft: 60,
            startTime: null
        };

        // Question bank
        const questionBank = [
            // Control Charts
            {
                category: 'control',
                question: '¬øCu√°l es el prop√≥sito principal de un gr√°fico de control?',
                options: ['Calcular la media del proceso', 'Distinguir variaci√≥n por causas comunes y especiales', 'Determinar el tama√±o de muestra', 'Calcular la capacidad del proceso'],
                correct: 1,
                explanation: 'Los gr√°ficos de control ayudan a distinguir entre variaci√≥n natural (causas comunes) y variaci√≥n asignable (causas especiales).'
            },
            {
                category: 'control',
                question: '¬øQu√© indica un punto fuera de los l√≠mites de control?',
                options: ['El proceso est√° centrado', 'El proceso es capaz', 'Posible causa especial de variaci√≥n', 'El tama√±o de muestra es incorrecto'],
                correct: 2,
                explanation: 'Un punto fuera de los l√≠mites de control indica una posible causa especial que debe investigarse.'
            },
            {
                category: 'control',
                question: '¬øCu√°ndo se recomienda usar un gr√°fico X-bar R en lugar de X-bar S?',
                options: ['Cuando n > 10', 'Cuando n ‚â§ 10', 'Siempre', 'Nunca'],
                correct: 1,
                explanation: 'El gr√°fico X-bar R se recomienda cuando el tama√±o de subgrupo es peque√±o (n ‚â§ 10). Para n > 10, es preferible X-bar S.'
            },
            {
                category: 'control',
                question: '¬øQu√© mide el gr√°fico R?',
                options: ['La media del proceso', 'La variabilidad dentro de subgrupos', 'La capacidad del proceso', 'El n√∫mero de defectos'],
                correct: 1,
                explanation: 'El gr√°fico R monitorea la variabilidad del proceso midiendo el rango dentro de cada subgrupo.'
            },
            {
                category: 'control',
                question: '¬øQu√© tipo de datos se monitorean con un gr√°fico p?',
                options: ['Mediciones continuas', 'Proporci√≥n de unidades defectuosas', 'N√∫mero de defectos por unidad', 'Rangos de subgrupos'],
                correct: 1,
                explanation: 'El gr√°fico p monitorea la proporci√≥n o porcentaje de unidades defectuosas en cada muestra.'
            },
            {
                category: 'control',
                question: '¬øCu√°l es la diferencia entre los gr√°ficos c y u?',
                options: ['c es para variables, u para atributos', 'c requiere √°rea constante, u permite √°rea variable', 'Son equivalentes', 'u es m√°s preciso que c'],
                correct: 1,
                explanation: 'El gr√°fico c requiere √°rea de oportunidad constante, mientras que u permite √°reas variables calculando defectos por unidad.'
            },

            // Process Capability
            {
                category: 'capability',
                question: '¬øQu√© mide el √≠ndice Cp?',
                options: ['El centrado del proceso', 'La capacidad potencial del proceso', 'El n√∫mero de defectos', 'La variaci√≥n entre lotes'],
                correct: 1,
                explanation: 'Cp mide la capacidad potencial del proceso comparando el ancho de especificaci√≥n con la dispersi√≥n del proceso (6œÉ).'
            },
            {
                category: 'capability',
                question: '¬øCu√°l es el valor m√≠nimo aceptable de Cpk para un proceso capaz?',
                options: ['0.67', '1.00', '1.33', '2.00'],
                correct: 2,
                explanation: 'Generalmente se considera que Cpk ‚â• 1.33 indica un proceso capaz. Cpk = 1.00 es el m√≠nimo aceptable.'
            },
            {
                category: 'capability',
                question: 'Si Cp = 1.5 y Cpk = 0.8, ¬øqu√© podemos concluir?',
                options: ['El proceso es incapaz', 'El proceso tiene variabilidad excesiva', 'El proceso est√° descentrado', 'Los l√≠mites de especificaci√≥n son incorrectos'],
                correct: 2,
                explanation: 'Cuando Cp > Cpk, indica que el proceso tiene potencial pero est√° descentrado respecto a las especificaciones.'
            },
            {
                category: 'capability',
                question: '¬øCu√°l es la f√≥rmula correcta para Cp?',
                options: ['(USL - LSL) / 3œÉ', '(USL - LSL) / 6œÉ', '(USL - Œº) / 3œÉ', 'min(Cpu, Cpl)'],
                correct: 1,
                explanation: 'Cp = (USL - LSL) / 6œÉ compara el ancho de especificaci√≥n con la dispersi√≥n del proceso.'
            },
            {
                category: 'capability',
                question: '¬øQu√© diferencia hay entre Cp y Pp?',
                options: ['Ninguna, son equivalentes', 'Cp usa œÉ dentro de subgrupos, Pp usa œÉ total', 'Pp considera el centrado, Cp no', 'Cp es para atributos, Pp para variables'],
                correct: 1,
                explanation: 'Cp usa la desviaci√≥n est√°ndar dentro de subgrupos (corto plazo), mientras Pp usa la desviaci√≥n est√°ndar total (largo plazo).'
            },
            {
                category: 'capability',
                question: '¬øCu√°ntos PPM defectuosos tiene un proceso con Cpk = 1.33?',
                options: ['2700', '63', '6210', '233'],
                correct: 1,
                explanation: 'Un proceso con Cpk = 1.33 (4œÉ) produce aproximadamente 63 PPM defectuosos.'
            },

            // Quality Tools
            {
                category: 'tools',
                question: '¬øQu√© principio representa el diagrama de Pareto?',
                options: ['Todo tiene igual importancia', '80% de efectos vienen del 20% de causas', 'Causa y efecto', 'Distribuci√≥n normal'],
                correct: 1,
                explanation: 'El principio de Pareto (80/20) indica que aproximadamente el 80% de los problemas provienen del 20% de las causas.'
            },
            {
                category: 'tools',
                question: '¬øCu√°les son las 6M del diagrama de Ishikawa?',
                options: ['Media, Mediana, Moda, M√°ximo, M√≠nimo, Muestra', 'Mano de obra, M√°quina, Material, M√©todo, Medici√≥n, Medio ambiente', 'Mejora, Medici√≥n, Modelo, Meta, M√©todo, Monitoreo', 'Ninguna de las anteriores'],
                correct: 1,
                explanation: 'Las 6M son: Mano de obra, M√°quina, Material, M√©todo, Medici√≥n y Medio ambiente.'
            },
            {
                category: 'tools',
                question: '¬øQu√© indica un coeficiente de correlaci√≥n r = -0.9?',
                options: ['Correlaci√≥n positiva fuerte', 'Correlaci√≥n negativa fuerte', 'Sin correlaci√≥n', 'Correlaci√≥n positiva d√©bil'],
                correct: 1,
                explanation: 'Un r cercano a -1 indica una correlaci√≥n negativa fuerte: cuando X aumenta, Y disminuye proporcionalmente.'
            },
            {
                category: 'tools',
                question: '¬øQu√© tipo de distribuci√≥n muestra un histograma con dos picos?',
                options: ['Normal', 'Sesgada', 'Bimodal', 'Uniforme'],
                correct: 2,
                explanation: 'Una distribuci√≥n bimodal tiene dos picos, lo que puede indicar mezcla de dos poblaciones o procesos diferentes.'
            }
        ];

        // Load player data from localStorage
        function loadPlayerData() {
            const saved = localStorage.getItem('spc_player_data');
            if (saved) {
                playerData = JSON.parse(saved);
            }
            updatePlayerUI();
        }

        // Save player data to localStorage
        function savePlayerData() {
            localStorage.setItem('spc_player_data', JSON.stringify(playerData));
        }

        // Update player UI
        function updatePlayerUI() {
            document.getElementById('playerPoints').textContent = playerData.points;
            document.getElementById('playerLevel').textContent = playerData.level;
            document.getElementById('playerStreak').textContent = playerData.streak;
            document.getElementById('playerCompleted').textContent = playerData.completed;
            document.getElementById('playerAchievements').textContent = `${playerData.achievements.length}/8`;

            // XP progress
            const xpNeeded = playerData.level * 100;
            const xpPercent = (playerData.xp / xpNeeded) * 100;
            document.getElementById('xpProgress').textContent = `${playerData.xp}/${xpNeeded} XP`;
            document.getElementById('xpBar').style.width = `${xpPercent}%`;

            // Update achievements display
            playerData.achievements.forEach(achievementId => {
                const card = document.querySelector(`[data-achievement="${achievementId}"]`);
                if (card) {
                    card.classList.remove('locked');
                    card.classList.add('unlocked');
                }
            });
        }

        // Add points and XP
        function addPoints(points) {
            playerData.points += points;
            playerData.xp += points;

            // Check for level up
            const xpNeeded = playerData.level * 100;
            if (playerData.xp >= xpNeeded) {
                playerData.xp -= xpNeeded;
                playerData.level++;
                showNotification(`üéâ ¬°Subiste al nivel ${playerData.level}!`);

                // Check level achievement
                if (playerData.level >= 3 && !playerData.achievements.includes('level-3')) {
                    unlockAchievement('level-3');
                }
            }

            // Check points achievement
            if (playerData.points >= 500 && !playerData.achievements.includes('spc-expert')) {
                unlockAchievement('spc-expert');
            }

            savePlayerData();
            updatePlayerUI();
        }

        // Unlock achievement
        function unlockAchievement(achievementId) {
            if (!playerData.achievements.includes(achievementId)) {
                playerData.achievements.push(achievementId);
                savePlayerData();

                const card = document.querySelector(`[data-achievement="${achievementId}"]`);
                if (card) {
                    card.classList.remove('locked');
                    card.classList.add('unlocked');

                    const name = card.querySelector('.achievement-name').textContent;
                    showNotification(`üèÜ ¬°Logro desbloqueado: ${name}!`);
                }
            }
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--gradient-accent);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.5s ease;
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Start practice mode
        function startPracticeMode(mode) {
            quizState.mode = mode;
            quizState.currentIndex = 0;
            quizState.correct = 0;
            quizState.totalPoints = 0;
            quizState.startTime = Date.now();

            // Select random questions
            const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
            quizState.questions = shuffled.slice(0, 5);

            // Configure UI based on mode
            document.getElementById('quizArea').classList.remove('hidden');
            document.getElementById('quizResults').classList.add('hidden');

            if (mode === 'quiz') {
                document.getElementById('quizModeIcon').textContent = 'üìù';
                document.getElementById('quizModeTitle').textContent = 'Quiz R√°pido';
                document.getElementById('quizTimer').classList.add('hidden');
            } else if (mode === 'interpretation') {
                document.getElementById('quizModeIcon').textContent = 'üìä';
                document.getElementById('quizModeTitle').textContent = 'Interpretaci√≥n de Datos';
                document.getElementById('quizTimer').classList.add('hidden');
            } else if (mode === 'timed') {
                document.getElementById('quizModeIcon').textContent = '‚è±Ô∏è';
                document.getElementById('quizModeTitle').textContent = 'Desaf√≠o Cronometrado';
                document.getElementById('quizTimer').classList.remove('hidden');
                quizState.timeLeft = 60;
                document.getElementById('quizTimer').textContent = quizState.timeLeft;
                startTimer();
            } else if (mode === 'calculation') {
                document.getElementById('quizArea').classList.add('hidden');
                startCalculationMode();
                return;
            }

            showQuestion();
        }

        // Show current question
        function showQuestion() {
            const q = quizState.questions[quizState.currentIndex];
            document.getElementById('quizProgress').textContent = `Pregunta ${quizState.currentIndex + 1} de ${quizState.questions.length}`;
            document.getElementById('quizQuestion').innerHTML = `<p><strong>${q.question}</strong></p>`;

            const optionsHtml = q.options.map((opt, i) =>
                `<div class="exercise-option" onclick="selectAnswer(${i}, this)">
                    <strong>${String.fromCharCode(65 + i)})</strong> ${opt}
                </div>`
            ).join('');

            document.getElementById('quizOptions').innerHTML = optionsHtml;
            document.getElementById('quizFeedback').style.display = 'none';
            document.getElementById('nextQuestionBtn').classList.add('hidden');
            document.getElementById('finishQuizBtn').classList.add('hidden');
        }

        // Select answer
        function selectAnswer(index, element) {
            const q = quizState.questions[quizState.currentIndex];
            const options = document.querySelectorAll('#quizOptions .exercise-option');

            // Disable further selections
            options.forEach(opt => opt.onclick = null);

            if (index === q.correct) {
                element.classList.add('correct');
                quizState.correct++;
                playerData.streak++;

                let points = 10;
                if (quizState.mode === 'timed') points = 15;
                if (quizState.mode === 'interpretation') points = 15;

                quizState.totalPoints += points;

                document.getElementById('quizFeedback').className = 'exercise-feedback correct';
                document.getElementById('quizFeedback').innerHTML = `<strong>‚úÖ ¬°Correcto! +${points} puntos</strong><br>${q.explanation}`;

                // Check streak achievement
                if (playerData.streak >= 5 && !playerData.achievements.includes('streak-5')) {
                    unlockAchievement('streak-5');
                }

                // Track category exercises
                if (q.category === 'control') playerData.controlExercises++;
                if (q.category === 'capability') playerData.capabilityExercises++;

                if (playerData.controlExercises >= 10 && !playerData.achievements.includes('control-master')) {
                    unlockAchievement('control-master');
                }
                if (playerData.capabilityExercises >= 10 && !playerData.achievements.includes('capability-expert')) {
                    unlockAchievement('capability-expert');
                }

            } else {
                element.classList.add('incorrect');
                options[q.correct].classList.add('correct');
                playerData.streak = 0;

                document.getElementById('quizFeedback').className = 'exercise-feedback incorrect';
                document.getElementById('quizFeedback').innerHTML = `<strong>‚ùå Incorrecto</strong><br>${q.explanation}`;
            }

            document.getElementById('quizFeedback').style.display = 'block';

            // Show next button
            if (quizState.currentIndex < quizState.questions.length - 1) {
                document.getElementById('nextQuestionBtn').classList.remove('hidden');
            } else {
                document.getElementById('finishQuizBtn').classList.remove('hidden');
            }

            savePlayerData();
        }

        // Next question
        function nextQuestion() {
            quizState.currentIndex++;
            showQuestion();
        }

        // Finish quiz
        function finishQuiz() {
            if (quizState.timerInterval) {
                clearInterval(quizState.timerInterval);
            }

            document.getElementById('quizArea').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');

            // Calculate results
            const score = quizState.correct;
            const total = quizState.questions.length;
            const timeElapsed = Math.floor((Date.now() - quizState.startTime) / 1000);

            // Bonus for speed in timed mode
            if (quizState.mode === 'timed' && quizState.timeLeft > 0) {
                quizState.totalPoints += quizState.timeLeft;
            }

            document.getElementById('resultsScore').textContent = `${score}/${total}`;
            document.getElementById('resultsPoints').textContent = `+${quizState.totalPoints}`;

            // Set emoji and title based on performance
            if (score === total) {
                document.getElementById('resultsEmoji').textContent = 'üèÜ';
                document.getElementById('resultsTitle').textContent = '¬°Perfecto!';
                if (!playerData.achievements.includes('perfect-quiz')) {
                    unlockAchievement('perfect-quiz');
                }
            } else if (score >= total * 0.8) {
                document.getElementById('resultsEmoji').textContent = 'üéâ';
                document.getElementById('resultsTitle').textContent = '¬°Excelente!';
            } else if (score >= total * 0.6) {
                document.getElementById('resultsEmoji').textContent = 'üëç';
                document.getElementById('resultsTitle').textContent = '¬°Bien hecho!';
            } else {
                document.getElementById('resultsEmoji').textContent = 'üìö';
                document.getElementById('resultsTitle').textContent = 'Sigue practicando';
            }

            // Check speed achievement
            if (timeElapsed < 60 && score >= 3 && !playerData.achievements.includes('speed-demon')) {
                unlockAchievement('speed-demon');
            }

            // First exercise achievement
            if (playerData.completed === 0 && !playerData.achievements.includes('first-exercise')) {
                unlockAchievement('first-exercise');
            }

            playerData.completed++;
            addPoints(quizState.totalPoints);
        }

        // Timer for timed mode
        function startTimer() {
            quizState.timerInterval = setInterval(() => {
                quizState.timeLeft--;
                document.getElementById('quizTimer').textContent = quizState.timeLeft;

                if (quizState.timeLeft <= 10) {
                    document.getElementById('quizTimer').style.color = 'var(--danger)';
                }

                if (quizState.timeLeft <= 0) {
                    clearInterval(quizState.timerInterval);
                    finishQuiz();
                }
            }, 1000);
        }

        // Close quiz
        function closeQuiz() {
            if (quizState.timerInterval) {
                clearInterval(quizState.timerInterval);
            }
            document.getElementById('quizArea').classList.add('hidden');
        }

        // Close results
        function closeResults() {
            document.getElementById('quizResults').classList.add('hidden');
        }

        // Calculation mode
        let calcState = {
            currentStep: 0,
            problem: null,
            answers: []
        };

        function startCalculationMode() {
            document.getElementById('stepCalculator').classList.remove('hidden');

            // Generate a random calculation problem
            const problems = [
                {
                    title: 'C√°lculo de l√≠mites X-bar R',
                    description: 'Calcula los l√≠mites de control para un gr√°fico X-bar R con los siguientes datos:',
                    data: { xDoublebar: 50.2, rBar: 4.5, n: 5 },
                    steps: [
                        { label: 'Calcular UCL para X-bar', formula: 'UCL = XÃø + A‚ÇÇRÃÑ', answer: 52.80, hint: 'A‚ÇÇ para n=5 es 0.577' },
                        { label: 'Calcular LCL para X-bar', formula: 'LCL = XÃø - A‚ÇÇRÃÑ', answer: 47.60, hint: 'Usa el mismo A‚ÇÇ' },
                        { label: 'Calcular UCL para R', formula: 'UCL = D‚ÇÑRÃÑ', answer: 9.51, hint: 'D‚ÇÑ para n=5 es 2.114' }
                    ]
                },
                {
                    title: 'C√°lculo de Cp y Cpk',
                    description: 'Calcula los √≠ndices de capacidad con los siguientes datos:',
                    data: { lsl: 48, usl: 52, mean: 50.5, sigma: 0.8 },
                    steps: [
                        { label: 'Calcular Cp', formula: 'Cp = (USL - LSL) / 6œÉ', answer: 0.83, hint: 'Cp mide capacidad potencial' },
                        { label: 'Calcular Cpu', formula: 'Cpu = (USL - Œº) / 3œÉ', answer: 0.63, hint: 'Distancia al l√≠mite superior' },
                        { label: 'Calcular Cpk', formula: 'Cpk = min(Cpu, Cpl)', answer: 0.63, hint: 'El menor de Cpu y Cpl' }
                    ]
                }
            ];

            calcState.problem = problems[Math.floor(Math.random() * problems.length)];
            calcState.currentStep = 0;
            calcState.answers = [];

            document.getElementById('calcTopic').textContent = calcState.problem.title;
            document.getElementById('calcProblem').innerHTML = `
                <p>${calcState.problem.description}</p>
                <div class="info-box" style="margin-top: 15px;">
                    ${Object.entries(calcState.problem.data).map(([key, val]) =>
                        `<strong>${key}:</strong> ${val}`
                    ).join(' | ')}
                </div>
            `;

            showCalcStep();
        }

        function showCalcStep() {
            const step = calcState.problem.steps[calcState.currentStep];

            document.getElementById('calcSteps').innerHTML = calcState.problem.steps.map((s, i) => `
                <div class="step" style="${i < calcState.currentStep ? 'opacity: 0.5;' : ''} ${i === calcState.currentStep ? 'border-left-color: var(--accent);' : ''}">
                    <div class="step-number" style="${i < calcState.currentStep ? 'background: var(--success);' : ''}">${i < calcState.currentStep ? '‚úì' : i + 1}</div>
                    <div class="step-content">
                        <h4>${s.label}</h4>
                        <p>${s.formula}</p>
                        ${i < calcState.currentStep ? `<p style="color: var(--success);">Respuesta: ${calcState.answers[i]}</p>` : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('calcInputArea').innerHTML = `
                <div class="control-group">
                    <label class="control-label">${step.label}:</label>
                    <input type="number" id="calcAnswer" class="control-input" step="0.01" placeholder="Ingresa tu respuesta">
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;">üí° ${step.hint}</small>
                </div>
            `;

            document.getElementById('calcFeedback').style.display = 'none';
            document.getElementById('calcCheckBtn').classList.remove('hidden');
            document.getElementById('calcNextBtn').classList.add('hidden');
            document.getElementById('calcFinishBtn').classList.add('hidden');
        }

        function checkCalculation() {
            const userAnswer = parseFloat(document.getElementById('calcAnswer').value);
            const correctAnswer = calcState.problem.steps[calcState.currentStep].answer;

            const tolerance = correctAnswer * 0.02; // 2% tolerance

            if (Math.abs(userAnswer - correctAnswer) <= tolerance) {
                calcState.answers.push(userAnswer);
                document.getElementById('calcFeedback').innerHTML = `<strong>‚úÖ ¬°Correcto!</strong> El valor es ${correctAnswer.toFixed(2)}`;
                document.getElementById('calcFeedback').className = 'info-box';
                document.getElementById('calcFeedback').style.display = 'block';
                document.getElementById('calcFeedback').style.background = 'rgba(46, 125, 50, 0.2)';
                document.getElementById('calcFeedback').style.borderLeftColor = 'var(--success)';

                document.getElementById('calcCheckBtn').classList.add('hidden');

                if (calcState.currentStep < calcState.problem.steps.length - 1) {
                    document.getElementById('calcNextBtn').classList.remove('hidden');
                } else {
                    document.getElementById('calcFinishBtn').classList.remove('hidden');
                }

                playerData.streak++;
            } else {
                document.getElementById('calcFeedback').innerHTML = `<strong>‚ùå Incorrecto.</strong> Revisa tu c√°lculo. Pista: el resultado debe estar cerca de ${correctAnswer.toFixed(2)}`;
                document.getElementById('calcFeedback').className = 'info-box';
                document.getElementById('calcFeedback').style.display = 'block';
                document.getElementById('calcFeedback').style.background = 'rgba(198, 40, 40, 0.2)';
                document.getElementById('calcFeedback').style.borderLeftColor = 'var(--danger)';
                playerData.streak = 0;
            }

            savePlayerData();
        }

        function nextCalcStep() {
            calcState.currentStep++;
            showCalcStep();
        }

        function finishCalculation() {
            playerData.completed++;
            addPoints(20);

            if (playerData.completed === 1 && !playerData.achievements.includes('first-exercise')) {
                unlockAchievement('first-exercise');
            }

            closeCalculator();
            showNotification('üéâ ¬°Ejercicio completado! +20 puntos');
        }

        function closeCalculator() {
            document.getElementById('stepCalculator').classList.add('hidden');
        }

        // Initialize gamification on app load
        const originalInitializeApp = initializeApp;
        initializeApp = function() {
            originalInitializeApp();
            loadPlayerData();
        };

        // ============================================
        // SIMULATOR FUNCTIONS
        // ============================================

        let simChart1Instance = null;
        let simChart2Instance = null;

        // Update simulator UI based on analysis type
        function updateSimulatorUI() {
            const type = document.getElementById('simAnalysisType').value;

            // Show/hide configs
            document.getElementById('simXbarRConfig').classList.toggle('hidden', type === 'individual' || type === 'p-chart');
            document.getElementById('simCapabilityConfig').classList.toggle('hidden', type !== 'capability');
        }

        // Generate random data
        function generateSimData() {
            const type = document.getElementById('simAnalysisType').value;
            const scenario = document.getElementById('simScenario').value;
            const mean = parseFloat(document.getElementById('simTargetMean').value);
            const sigma = parseFloat(document.getElementById('simTargetSigma').value);
            const numSamples = parseInt(document.getElementById('simNumSamples').value);
            const subgroupSize = parseInt(document.getElementById('simSubgroupSize').value) || 5;

            let data = [];

            if (type === 'xbar-r' || type === 'capability') {
                // Generate subgroups
                for (let i = 0; i < numSamples; i++) {
                    let row = [];
                    for (let j = 0; j < subgroupSize; j++) {
                        let value = randomNormal(mean, sigma);

                        // Apply scenario effects
                        if (scenario === 'shift' && i >= numSamples * 0.6) {
                            value += sigma * 1.5;
                        } else if (scenario === 'trend') {
                            value += (i / numSamples) * sigma * 2;
                        } else if (scenario === 'high-var') {
                            value = randomNormal(mean, sigma * 2);
                        } else if (scenario === 'out-of-spec' && Math.random() < 0.15) {
                            value = mean + (Math.random() > 0.5 ? 1 : -1) * sigma * 4;
                        }

                        row.push(value.toFixed(2));
                    }
                    data.push(row.join(', '));
                }
            } else if (type === 'individual') {
                // Generate individual values
                for (let i = 0; i < numSamples; i++) {
                    let value = randomNormal(mean, sigma);

                    if (scenario === 'shift' && i >= numSamples * 0.6) {
                        value += sigma * 1.5;
                    } else if (scenario === 'trend') {
                        value += (i / numSamples) * sigma * 2;
                    }

                    data.push(value.toFixed(2));
                }
            } else if (type === 'p-chart') {
                // Generate defect counts
                const p = 0.05; // 5% defect rate
                const sampleSize = 100;
                for (let i = 0; i < numSamples; i++) {
                    let defects = 0;
                    for (let j = 0; j < sampleSize; j++) {
                        if (Math.random() < p) defects++;
                    }

                    if (scenario === 'shift' && i >= numSamples * 0.6) {
                        defects += Math.floor(sampleSize * 0.03);
                    }

                    data.push(`${defects}/${sampleSize}`);
                }
            }

            document.getElementById('simDataInput').value = data.join('\n');
        }

        // Clear simulator data
        function clearSimData() {
            document.getElementById('simDataInput').value = '';
            document.getElementById('simResultsSection').classList.add('hidden');
        }

        // Analyze simulator data
        function analyzeSimData() {
            const type = document.getElementById('simAnalysisType').value;
            const dataText = document.getElementById('simDataInput').value.trim();

            if (!dataText) {
                alert('Por favor ingresa datos para analizar');
                return;
            }

            // Parse data based on type
            let parsedData;
            try {
                if (type === 'xbar-r' || type === 'capability') {
                    parsedData = parseSubgroupData(dataText);
                } else if (type === 'individual') {
                    parsedData = parseIndividualData(dataText);
                } else if (type === 'p-chart') {
                    parsedData = parsePChartData(dataText);
                }
            } catch (e) {
                alert('Error al parsear datos: ' + e.message);
                return;
            }

            // Show results section
            document.getElementById('simResultsSection').classList.remove('hidden');

            // Perform analysis
            if (type === 'xbar-r') {
                analyzeXbarR(parsedData);
            } else if (type === 'individual') {
                analyzeIMR(parsedData);
            } else if (type === 'p-chart') {
                analyzePChart(parsedData);
            } else if (type === 'capability') {
                analyzeCapability(parsedData);
            }

            // Scroll to results
            document.getElementById('simResultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Parse subgroup data
        function parseSubgroupData(text) {
            const lines = text.split('\n').filter(l => l.trim());
            const subgroups = [];

            for (const line of lines) {
                const values = line.split(/[,\s\t]+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
                if (values.length > 0) {
                    subgroups.push(values);
                }
            }

            return subgroups;
        }

        // Parse individual data
        function parseIndividualData(text) {
            const values = text.split(/[,\s\t\n]+/).map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
            return values;
        }

        // Parse p-chart data
        function parsePChartData(text) {
            const lines = text.split('\n').filter(l => l.trim());
            const data = [];

            for (const line of lines) {
                const parts = line.split('/');
                if (parts.length === 2) {
                    data.push({
                        defects: parseInt(parts[0].trim()),
                        n: parseInt(parts[1].trim())
                    });
                } else {
                    const val = parseInt(line.trim());
                    if (!isNaN(val)) {
                        data.push({ defects: val, n: 100 });
                    }
                }
            }

            return data;
        }

        // Analyze X-bar R
        function analyzeXbarR(subgroups) {
            const n = subgroups[0].length;
            const constants = CONSTANTS[n] || CONSTANTS[5];

            const means = subgroups.map(sg => sg.reduce((a, b) => a + b, 0) / sg.length);
            const ranges = subgroups.map(sg => Math.max(...sg) - Math.min(...sg));

            const xDoublebar = means.reduce((a, b) => a + b, 0) / means.length;
            const rBar = ranges.reduce((a, b) => a + b, 0) / ranges.length;

            const uclX = xDoublebar + constants.A2 * rBar;
            const lclX = xDoublebar - constants.A2 * rBar;
            const uclR = constants.D4 * rBar;
            const lclR = constants.D3 * rBar;

            const oocX = means.filter(m => m > uclX || m < lclX).length;
            const oocR = ranges.filter(r => r > uclR || r < lclR).length;

            // Update UI
            document.getElementById('simResultsSubtitle').textContent = 'Gr√°fico XÃÑ-R';
            document.getElementById('simStatMean').textContent = xDoublebar.toFixed(3);
            document.getElementById('simStatSigma').textContent = (rBar / constants.d2).toFixed(3);
            document.getElementById('simStatUCL').textContent = uclX.toFixed(3);
            document.getElementById('simStatLCL').textContent = lclX.toFixed(3);
            document.getElementById('simStatOOC').textContent = `${oocX + oocR}`;

            document.getElementById('simCapabilityResults').classList.add('hidden');
            document.getElementById('simChart1Title').textContent = 'Gr√°fico XÃÑ';
            document.getElementById('simChart2Title').textContent = 'Gr√°fico R';

            // Create charts
            createSimControlChart('simChart1', means, xDoublebar, uclX, lclX, 'XÃÑ', '#42a5f5');
            createSimControlChart('simChart2', ranges, rBar, uclR, lclR, 'R', '#ff9800');

            // Interpretation
            let interpretation = `<p style="margin-top: 10px;">`;
            if (oocX + oocR === 0) {
                interpretation += `‚úÖ <strong>Proceso bajo control estad√≠stico.</strong> No se detectaron puntos fuera de los l√≠mites de control.`;
            } else {
                interpretation += `‚ö†Ô∏è <strong>Se detectaron ${oocX + oocR} puntos fuera de control</strong> (${oocX} en XÃÑ, ${oocR} en R). Investigar causas especiales.`;
            }
            interpretation += `</p><p style="margin-top: 10px;">
                <strong>L√≠mites calculados:</strong><br>
                XÃÑ: LCL = ${lclX.toFixed(3)}, CL = ${xDoublebar.toFixed(3)}, UCL = ${uclX.toFixed(3)}<br>
                R: LCL = ${lclR.toFixed(3)}, CL = ${rBar.toFixed(3)}, UCL = ${uclR.toFixed(3)}
            </p>`;

            document.getElementById('simInterpretationContent').innerHTML = interpretation;
        }

        // Analyze I-MR
        function analyzeIMR(values) {
            const n = values.length;
            const mean = values.reduce((a, b) => a + b, 0) / n;

            // Calculate moving ranges
            const mRanges = [];
            for (let i = 1; i < n; i++) {
                mRanges.push(Math.abs(values[i] - values[i - 1]));
            }
            const mrBar = mRanges.reduce((a, b) => a + b, 0) / mRanges.length;

            // Control limits (using d2 = 1.128 for n=2)
            const sigma = mrBar / 1.128;
            const uclI = mean + 3 * sigma;
            const lclI = mean - 3 * sigma;
            const uclMR = 3.267 * mrBar;
            const lclMR = 0;

            const oocI = values.filter(v => v > uclI || v < lclI).length;
            const oocMR = mRanges.filter(r => r > uclMR).length;

            // Update UI
            document.getElementById('simResultsSubtitle').textContent = 'Gr√°fico I-MR';
            document.getElementById('simStatMean').textContent = mean.toFixed(3);
            document.getElementById('simStatSigma').textContent = sigma.toFixed(3);
            document.getElementById('simStatUCL').textContent = uclI.toFixed(3);
            document.getElementById('simStatLCL').textContent = lclI.toFixed(3);
            document.getElementById('simStatOOC').textContent = `${oocI + oocMR}`;

            document.getElementById('simCapabilityResults').classList.add('hidden');
            document.getElementById('simChart1Title').textContent = 'Gr√°fico I (Individual)';
            document.getElementById('simChart2Title').textContent = 'Gr√°fico MR (Rango M√≥vil)';

            createSimControlChart('simChart1', values, mean, uclI, lclI, 'I', '#42a5f5');
            createSimControlChart('simChart2', mRanges, mrBar, uclMR, lclMR, 'MR', '#ff9800');

            let interpretation = `<p style="margin-top: 10px;">`;
            if (oocI + oocMR === 0) {
                interpretation += `‚úÖ <strong>Proceso bajo control.</strong>`;
            } else {
                interpretation += `‚ö†Ô∏è <strong>${oocI + oocMR} puntos fuera de control.</strong>`;
            }
            interpretation += `</p>`;
            document.getElementById('simInterpretationContent').innerHTML = interpretation;
        }

        // Analyze p-chart
        function analyzePChart(data) {
            const totalDefects = data.reduce((sum, d) => sum + d.defects, 0);
            const totalN = data.reduce((sum, d) => sum + d.n, 0);
            const pBar = totalDefects / totalN;

            const proportions = data.map(d => d.defects / d.n);
            const ucl = data.map(d => Math.min(1, pBar + 3 * Math.sqrt(pBar * (1 - pBar) / d.n)));
            const lcl = data.map(d => Math.max(0, pBar - 3 * Math.sqrt(pBar * (1 - pBar) / d.n)));

            const ooc = proportions.filter((p, i) => p > ucl[i] || p < lcl[i]).length;

            document.getElementById('simResultsSubtitle').textContent = 'Gr√°fico p';
            document.getElementById('simStatMean').textContent = (pBar * 100).toFixed(2) + '%';
            document.getElementById('simStatSigma').textContent = '--';
            document.getElementById('simStatUCL').textContent = (Math.max(...ucl) * 100).toFixed(2) + '%';
            document.getElementById('simStatLCL').textContent = (Math.min(...lcl) * 100).toFixed(2) + '%';
            document.getElementById('simStatOOC').textContent = ooc.toString();

            document.getElementById('simCapabilityResults').classList.add('hidden');
            document.getElementById('simChart1Title').textContent = 'Gr√°fico p';
            document.getElementById('simChart2Title').textContent = 'Tama√±o de Muestra';

            // Create p-chart with variable limits
            createSimPChart(proportions, pBar, ucl, lcl);

            document.getElementById('simInterpretationContent').innerHTML = `
                <p style="margin-top: 10px;">
                    ${ooc === 0 ? '‚úÖ' : '‚ö†Ô∏è'} <strong>Proporci√≥n promedio de defectuosos:</strong> ${(pBar * 100).toFixed(2)}%<br>
                    <strong>Puntos fuera de control:</strong> ${ooc}
                </p>
            `;
        }

        // Analyze capability
        function analyzeCapability(subgroups) {
            const lsl = parseFloat(document.getElementById('simLSL').value);
            const usl = parseFloat(document.getElementById('simUSL').value);

            // Flatten all data
            const allData = subgroups.flat();
            const n = allData.length;
            const mean = allData.reduce((a, b) => a + b, 0) / n;
            const sigma = Math.sqrt(allData.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / (n - 1));

            const cp = (usl - lsl) / (6 * sigma);
            const cpu = (usl - mean) / (3 * sigma);
            const cpl = (mean - lsl) / (3 * sigma);
            const cpk = Math.min(cpu, cpl);

            document.getElementById('simResultsSubtitle').textContent = 'An√°lisis de Capacidad';
            document.getElementById('simStatMean').textContent = mean.toFixed(3);
            document.getElementById('simStatSigma').textContent = sigma.toFixed(3);
            document.getElementById('simStatUCL').textContent = usl.toFixed(3);
            document.getElementById('simStatLCL').textContent = lsl.toFixed(3);
            document.getElementById('simStatOOC').textContent = allData.filter(v => v < lsl || v > usl).length.toString();

            document.getElementById('simCapabilityResults').classList.remove('hidden');
            updateSimCapabilityValue('simCp', cp);
            updateSimCapabilityValue('simCpk', cpk);
            document.getElementById('simCpu').textContent = cpu.toFixed(2);
            document.getElementById('simCpl').textContent = cpl.toFixed(2);

            document.getElementById('simChart1Title').textContent = 'Histograma con Especificaciones';
            document.getElementById('simChart2Title').textContent = 'Tendencia de Datos';

            createSimHistogram(allData, lsl, usl);
            createSimTrendChart(allData, lsl, usl);

            let status = cpk >= 1.33 ? '‚úÖ Proceso capaz' : (cpk >= 1.0 ? '‚ö†Ô∏è Proceso marginal' : '‚ùå Proceso incapaz');
            document.getElementById('simInterpretationContent').innerHTML = `
                <p style="margin-top: 10px;">
                    <strong>Estado:</strong> ${status}<br>
                    <strong>Cp:</strong> ${cp.toFixed(2)} | <strong>Cpk:</strong> ${cpk.toFixed(2)}<br>
                    ${cp > cpk + 0.2 ? '‚ö†Ô∏è El proceso est√° descentrado. Considere ajustar la media.' : ''}
                </p>
            `;
        }

        function updateSimCapabilityValue(id, value) {
            const el = document.getElementById(id);
            el.textContent = value.toFixed(2);
            el.className = 'capability-value';
            if (value >= 1.33) el.classList.add('good');
            else if (value >= 1.0) el.classList.add('marginal');
            else el.classList.add('poor');
        }

        // Create control chart for simulator
        function createSimControlChart(canvasId, data, cl, ucl, lcl, label, color) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');

            if (canvasId === 'simChart1' && simChart1Instance) simChart1Instance.destroy();
            if (canvasId === 'simChart2' && simChart2Instance) simChart2Instance.destroy();

            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => i + 1),
                    datasets: [
                        {
                            label: label,
                            data: data,
                            borderColor: color,
                            backgroundColor: color + '20',
                            pointBackgroundColor: data.map(v => v > ucl || v < lcl ? '#ff6b6b' : color),
                            pointRadius: 5,
                            tension: 0.1
                        },
                        { label: 'UCL', data: Array(data.length).fill(ucl), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0 },
                        { label: 'CL', data: Array(data.length).fill(cl), borderColor: '#4caf50', borderDash: [10, 5], pointRadius: 0 },
                        { label: 'LCL', data: Array(data.length).fill(lcl), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });

            if (canvasId === 'simChart1') simChart1Instance = chart;
            else simChart2Instance = chart;
        }

        // Create p-chart with variable limits
        function createSimPChart(proportions, pBar, ucl, lcl) {
            if (simChart1Instance) simChart1Instance.destroy();
            if (simChart2Instance) simChart2Instance.destroy();

            const ctx1 = document.getElementById('simChart1').getContext('2d');
            simChart1Instance = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: proportions.map((_, i) => i + 1),
                    datasets: [
                        {
                            label: 'p',
                            data: proportions.map(p => p * 100),
                            borderColor: '#9c27b0',
                            pointBackgroundColor: proportions.map((p, i) => p > ucl[i] || p < lcl[i] ? '#ff6b6b' : '#9c27b0'),
                            pointRadius: 5,
                            tension: 0.1
                        },
                        { label: 'UCL', data: ucl.map(u => u * 100), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0, tension: 0.4 },
                        { label: 'pÃÑ', data: Array(proportions.length).fill(pBar * 100), borderColor: '#4caf50', borderDash: [10, 5], pointRadius: 0 },
                        { label: 'LCL', data: lcl.map(l => l * 100), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0, tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { title: { display: true, text: '% Defectuosos', color: '#b2bac2' }, ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' }, min: 0 }
                    }
                }
            });
        }

        // Create histogram for capability
        function createSimHistogram(data, lsl, usl) {
            if (simChart1Instance) simChart1Instance.destroy();

            const min = Math.min(...data, lsl);
            const max = Math.max(...data, usl);
            const bins = 15;
            const binWidth = (max - min) / bins;

            const histogram = new Array(bins).fill(0);
            const binLabels = [];

            for (let i = 0; i < bins; i++) {
                const binStart = min + i * binWidth;
                binLabels.push(binStart.toFixed(1));
                for (const val of data) {
                    if (val >= binStart && (i === bins - 1 ? val <= binStart + binWidth : val < binStart + binWidth)) {
                        histogram[i]++;
                    }
                }
            }

            const ctx = document.getElementById('simChart1').getContext('2d');
            simChart1Instance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frecuencia',
                        data: histogram,
                        backgroundColor: binLabels.map(l => {
                            const v = parseFloat(l);
                            return v < lsl || v > usl ? 'rgba(198, 40, 40, 0.7)' : 'rgba(0, 137, 123, 0.7)';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }

        // Create trend chart for capability
        function createSimTrendChart(data, lsl, usl) {
            if (simChart2Instance) simChart2Instance.destroy();

            const ctx = document.getElementById('simChart2').getContext('2d');
            simChart2Instance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => i + 1),
                    datasets: [
                        {
                            label: 'Datos',
                            data: data,
                            borderColor: '#42a5f5',
                            pointBackgroundColor: data.map(v => v < lsl || v > usl ? '#ff6b6b' : '#42a5f5'),
                            pointRadius: 3,
                            tension: 0.1
                        },
                        { label: 'USL', data: Array(data.length).fill(usl), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0 },
                        { label: 'LSL', data: Array(data.length).fill(lsl), borderColor: '#ff6b6b', borderDash: [5, 5], pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#b2bac2' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }
    </script>
</body>
</html>
